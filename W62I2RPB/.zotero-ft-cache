bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.

1

Consolidation of human skill linked to waking hippocampo-neocortical replay

2

3

4

5

6 Buch ER1*‚Ä†, Claudino L1‚Ä†, Quentin R1, B√∂nstrup M1, Cohen LG1

7

8 Human Cortical Physiology and Neurorehabilitation Section, NINDS, NIH, Bethesda, MD, USA.

9

10 *Correspondence: ethan.buch@nih.gov (E.R.B.) or cohenl@ninds.nih.gov (L.G.C.)

11 ‚Ä†E.R.B. and L.C. contributed equally to this work.

12

13 Summary

14

15 The introduction of rest intervals interspersed with practice strengthens wakeful consolidation of

16 skill. The mechanisms by which the brain binds discrete action representations into consolidated,

17 highly temporally-resolved skill sequences during waking rest are not known. To address this

18 question, we recorded magnetoencephalography (MEG) during acquisition and rapid

19 consolidation of a sequential motor skill. We report the presence of highly prominent, fast waking

20 neural replay during the same rest periods in which rapid consolidation occurs. The observed

21 replay was temporally compressed by approximately 20x relative to the acquired skill, occurred in

22 both forward and reverse directions, was selective for the trained sequence and predicted the

23 magnitude of skill consolidation. Replay representations extended beyond the hippocampus and

24 entrorhinal cortex to the contralateral sensorimotor cortex. These results document the presence of

25 robust hippocampo-neocortical replay supporting rapid wakeful consolidation of skill.

26

27 Keywords

28 replay; human motor learning; skill learning; offline learning; consolidation; generalization;

29 hippocampus; entorhinal cortex; sensorimotor cortex; MEG;

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
30 Introduction 31 32 The popular idiom, ‚Äúpractice makes perfect‚Äù, emphasizes the importance of intense practice in 33 acquiring and perfecting skill1. However, the same amount of practice results in significantly 34 different skill depending on the presence or absence of waking rest within the training schedule, a 35 phenomena termed the spacing effect2. Consolidation of skill is superior when frequent rest periods 36 are interspersed with practice blocks (distributed practice) than when the same total amount of 37 practice is performed over longer continuous blocks (massed practice)2, 3, 4, 5, 6. Thus, the presence 38 of waking rest interleaved with practice is a crucial determinant of skill memory consolidation. 39 40 Consistent with this notion, it has been proposed that ‚Äúmuch, if not all‚Äù skill learning occurs offline 41 during rest rather than during actual practice7. For example, performance improvements while 42 acquiring a new skill accumulate almost exclusively during waking rest periods interleaved with 43 practice8. These micro-offline gains indicate a rapid form of skill memory consolidation that 44 develops over a much shorter timescale than previously thought8, 9, 10, and that is approximately 45 four times greater in magnitude than classically studied overnight consolidation requiring sleep8. 46 47 Skill learning involves forming new memories through binding, a process that hierarchically links 48 simple action elements (e.g. ‚Äì a single piano key press) to construct representations of complex 49 spatiotemporal sequences (e.g. ‚Äì a refrain within a classical piano concerto)11, 12, 13, 14. How the 50 brain binds sequences of discrete action representations into consolidated, temporally precise skills 51 during waking rest is not known2, 4, 9. One possible candidate mechanism is neural replay, the 52 temporally-compressed reactivation of neural activity patterns representing behavioral sequences 53 during rest. Previous work in rodents has shown that hippocampal replay constructs 54 representations of navigational maps through relational binding of discrete spatial locations into 55 trajectories15. Hippocampal activity has been documented during rest periods of early learning9, 16. 56 Thus, it is possible that waking replay, through offline recapitulation of prior practice15, 17, 18, 19, 57 promotes wakeful consolidation of skill; an issue that has not been investigated in humans or 58 animal models15, 20. 59 60 Here, we posited a contribution of neural replay in wakeful memory consolidation. We tested this 61 by applying a multivariate analytical approach to magnetoencephalography (MEG) brain activity 62 data acquired during skill learning to decode spontaneous, waking replay during the periods of rest 63 in which sequences of simple discrete actions learned during interspersed practice are bound into 64 a consolidated skill. 65 66 67 Results 68 69 Wakeful consolidation of skill was evaluated using a keypress sequence task13, 21 that shows rapid 70 memory strengthening over a single session8. Subjects were instructed to type the sequence, 41324, 71 on a keyboard as fast and accurately as possible during each 10-second practice period. Thirty-six 72 10-second practice periods (trials) were interleaved with 10-second rest periods (Fig. 1). Skill was 73 measured as the correct sequence typing speed (sequences per second, seq/s). Early learning, 74 encompassing the set of trials within which 95% of total learning occurred, was explained by

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
75 micro-offline, but not micro-online gains (Fig. 1D). That is, skill improvement occurred during 76 waking rest, but not during active practice (Fig. 1C and D). 77 78 Fast replay of skill sequences is prominent during waking rest interspersed with practice 79 80 Next, we examined parcellated, source-space MEG brain activity data for evidence of spontaneous 81 replay of the trained sequence during waking rest (Fig. 2). We used Radial-basis Support Vector 82 Machine decoders to interrogate resting-state MEG data for individual replay events (see Methods 83 for details). Practice data segments centered on individual keypress events were used to train four 84 one-versus-all keypress state decoders (i.e. ‚Äì one decoder per finger). We then applied these 85 decoders to waking rest MEG data to detect replay events (Fig. 2A) that occurred during pre86 training, inter-practice and post-training rest periods. Since replay is known to be temporally 87 compressed to different degrees relative to behavior, we looked for replay over a range of durations 88 (25-2500ms) corresponding to different compression magnitudes (approximately 0.4-40x) relative 89 to the acquired skill (the average correct sequence duration by the end of early learning was 90 1037.7¬±61.7ms; Mean¬±SEM; Fig. 1B). 91 92 Neural replay of the full trained sequence was identified in all waking rest periods examined. 93 However, detection rates (i.e. ‚Äì the number of replay events detected per second) varied depending 94 on replay duration (i.e. ‚Äì compression magnitude; Fig. 2B). Forward replay rates for the trained 95 sequence (41324) were most prominent for events lasting 50ms and progressively decreased for 96 longer event durations (Fig. 2B; see Fig. S2A for reverse replay of the trained sequence, 42314). 97 Thus, the modal neural replay representation of the skill was temporally compressed 98 approximately 20x relative to the actual behavior. Figure 2C highlights the large difference in 99 forward replay rates across the different waking rest states (F2,58=15.26, p=0.000018). 100 Specifically, forward replay events during inter-practice rest occurred approximately 3 times more 101 frequently (2.44¬±0.29 replays/s) relative to pre-training (0.75¬±0.21 replays/s, p=0.00528) or post102 training rest (0.88¬±0.21 replays/s, p=0.00089, Fig 2C), which were both comparable (p=0.2972). 103 Reverse replay of the trained sequence exhibited similar features (Fig. S2B). Elevated replay rates 104 were maintained across all individual inter-practice rest periods (Fig. S3A). Within each of these 105 rest periods, replay events were likely to occur in clusters (Fig. S3B,D) that were uniformally 106 distributed across the entire 10 seconds (Fig. S3B,C). Finally, mean replay rates during early 107 learning (initial 11 trials) were significantly higher than during late learning (last 11 trials; t29 = 108 2.66, p = 0.006, one-tailed). 109 110 We also interrogated resting-state MEG data for fictive replay of a single unpracticed control 111 sequence (33433). This sequence was selected on the basis that it is the only unpracticed sequence 112 combination (out of 1,022 possible alternatives) that shares no common ordinal position or 113 transition structure with forward and reverse replay of the practiced one. This analysis rendered 114 two important results. First, we detected fictive replay of this unpracticed control sequence in all 115 waking rest periods examined, and with comparable pretraining-rest rates to both forward and 116 reverse replay of the practiced one. However, after practice onset there was a greater increase 117 (F2,87=6.42; p=0.002) for both forward (p=0.0062; Bonferonni-corrected) and reverse (p=0.0099; 118 Bonferonni-corrected) replay rates for the trained sequence relative to this control (Fig. 2D; see 119 also Fig. S2C for additional control sequences). Thus, replay during skill learning is selective for, 120 but not exclusive to, the trained motor skill sequence.

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
121 122 Replay of the learned skill is represented within a mediotemporal-sensorimotor network 123 124 We also examined the spatiotemporal features of replay event dynamics. After averaging all 50ms 125 duration forward replay event epochs detected by the decoding pipeline during inter-practice rest, 126 we applied principal component analysis (PCA) to extract low-dimensional networks with co127 varying source-space power changes during fast replay. Two orthogonal networks explained 128 86.6% of the total signal variance during an average replay event. The first network (PC1 129 explaining 67.8% of total variance) featured sensorimotor, entorhinal, and hippocampal regions 130 (Fig. 3). It also included the precuneus, one of the main outputs of the hippocampus to the 131 neocortex22, 23, shown to be active in previous fMRI work during rest periods of early learning9. 132 The second network (PC2) included a similar set of regions except for the precuneus (Fig. S4). 133 Thus, replay of the skill is represented predominantly in sensorimotor, entorhinal and hippocampal 134 regions. 135 136 Forward and reverse replay correlate with wakeful consolidation of skill 137 138 Finally, we asked if wakeful consolidation in individual participants could be predicted by the rate 139 of replay events detected for the trained sequence during inter-practice rest intervals. We observed 140 significant correlations between inter-practice neural replay rate and cumulative micro-offline 141 gains (Fig. 4) for both forward (Fig. 4A; r=0.451, p=0.012) and reverse (Fig. 4B; r=0.521, p=0.003) 142 replay of the trained sequence. On the other hand, replay of the control sequence (33433; see 143 Methods) did not correlate with behavior (r=0.165, p=0.38). In summary, greater replay rates 144 related to the trained sequence predicted greater rapid wakeful skill consolidation across 145 individuals. 146 147 148 Discussion 149 150 In this study, we address the question of how the brain consolidates memory during waking rest. 151 Positing a role for neural replay, we first document replay in medial temporal and sensorimotor 152 brain regions during wakeful human memory consolidation. We then demonstrate that replay is 153 temporally compressed by approximately 20x relative to the practiced behavior. Finally, we show 154 that forward and reverse waking replay rates increase rapidly after the onset of practice, display 155 selectivity for the trained sequence, and predict consolidation of skill. 156 157 The presence of waking rest interspersed with practice influences successful learning. For 158 example, skill memory is enhanced when practice events are separated by rest rather than massed 159 in immediate succession, a phenomena known as the ‚Äúspacing effect‚Äù. This observation, initially 160 made by Ebbington in 188524, has been repeatedly documented across cognitive domains2, 3, 4, 5, 6. 161 Waking rest also contributes to skill acquisition. Early learning (a time period where performance 162 improves exponentially) is largely accounted for by micro-offline gains that occur between, rather 163 than during practice periods8. Thus, a form of wakeful consolidation of skill develops over seconds 164 and minutes ‚Äì much shorter timescales than previously thought10. Importantly, this form of 165 wakeful memory consolidation is approximately four times greater in magnitude than classically 166 studied overnight consolidation, which requires sleep8, 9, and is preserved even when practice 167 exposure is reduced by half10. Here, we studied how the brain binds, during waking rest, sequences

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
168 of discrete motor actions learned during previous practice, leading to successful consolidation of 169 skill25. 170 171 Waking replay, displaying robust temporal features, was decoded during the same rest periods in 172 which rapid consolidation occurs. To our knowledge, this is the first demonstration of fast waking 173 human neural replay linked to memory consolidation. Replay of full practiced sequences had a 174 modal duration of approximately 50ms, representing a 20-fold temporal compression of keypress 175 sequence representations within each replay event relative to the duration of the actual skill 176 behavior. This is consistent with the range of compressions previously reported in animal models 177 as well as in humans25, 26, and is too fast to be explained by mental rehearsal or motor imagery 178 processes which share a veridical duration with executed behavior (in this case, 1000-2500ms 179 replay durations)27, 28. 180 181 Immediately following the initiation of practice, replay rates during interspersed rest periods 182 increased more than three-fold beginning with the first one (Fig. S3A). This finding is reminiscent 183 of the increase in waking replay rates in rodents upon introduction into a novel maze 184 environment15, 29. We also found a high likelihood for temporal clustering, as more than half of all 185 detected replay events were paired with a second event within a window of <200ms (Fig. S3D). 186 Such replay clustering25 has been linked to memory consolidation15. Following practice, replay 187 rates receded to pre-training levels rather rapidly contrary to the slow decrease reported in rodents30 188 ‚Äì a difference that could be attributed to the explicit awareness of training termination in humans 189 or to the presence of reward contingencies in rodents, absent in each of the other species19. 190 191 The increase in both forward and reverse waking replay18 rates for the trained sequence was larger 192 than for the alternative unpracticed sequences examined (Fig. 2D, S2C). While forward replay of 193 this trained sequence could support retrieval of information obtained during previous practice 194 relevant for planning and guiding action in the next practice period17, 30, 31, reverse replay could 195 contribute to the evaluation of recent practice outcomes.17, 18, 19, 25 Alternatively, the increase in 196 reverse replay could have been driven by shared ordinal locations with the trained sequence. The 197 fictive replay we observed for unpracticed sequences is not suprising given that studies of 198 navigation memory in rodents have repeatedly shown that hippocampal cell assemblies generate 199 plausible trajectories or sequences that have not yet been explored32, 33, 34. It is possible that such 200 fictive replay events reflect more generalizable abstract knowledge structures (i.e. ‚Äì cognitive 201 maps) important for skill transfer35. The keypress sequence representations we also observed 202 during pre-training rest after subjects had received task instructions but before they initiated 203 practice (Fig. 1A, 2B) can be similarly explained. Evidence of ‚Äúpre-play‚Äù in rodents indicates 204 these reactivation patterns could be generated from intrinsic neural dynamics supporting broad 205 sequence representations that are subsequently tuned through experience32, 36. Alternatively, it is 206 also possible that semantic knowledge about the task requirements was enough to elicit replay of 207 keypress sequences in preparation of the impending training 25. 208 209 Learning this skill requires binding individual discrete keypress actions into a fast, precise 210 spatiotemporal sequence37. While neural representations of individual keypresses ‚Äì stereotypical, 211 overlearned finger movements ‚Äì are highly invariant and maintained within the primary motor 212 cortex38, keypress sequence skills are spatially represented throughout a distributed frontoparietal 213 brain network that reorganizes with learning9, 16, 37, 38. Waking neural replay events characterized

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
214 here were encoded in regions that differed from those reported for practice sequences38 in the 215 proportion of hippocampal-entorhinal engagement11. The most parsimonious explanation for this 216 difference is that during the rest periods within which consolidation occurred, synchronization of 217 hippocampus with engaged neocortical regions potentiated the skill memory to a greater extent 218 than during practice itself39, 40. For individual replay events, which were detected on average 219 between 20-30 times during each 10-second long rest period, the hippocampus and entorhinal 220 cortex could engage memories encoding abstract knowledge about the action structure of the skill 221 sequence, while the sensorimotor cortex may engage memories containing information about the 222 kinematics and dynamics of the elemental finger movements. In this way, replay initiated by the 223 hippocampus could promote the binding of abstract knowledge about the action structure of the 224 skill with detailed sensory predictions important for execution and evaluation of the skill41, 42, 43. 225 This view is consistent with evidence of hippocampal involvement during rest periods of early 226 learning9, 16. Taken together, our data indicate that frequent, fast waking replay reinforces 227 hippocampus and neocortical associations learned during prior practice, a process relevant for 228 improving subsequent performance and wakeful consolidation of skill. Still, while the correlation 229 between replay of the trained sequence and micro-offline learning is strongly suggestive of a direct 230 contribution to consolidation of skill8, causality remains to be established in either animals or 231 humans44, 45. 232 233 We conclude that robust hippocampal and neocortical replay predicts micro-offline learning and 234 is a possible binding mechanism supporting wakeful memory consolidation. 235

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.

236

237 STAR Methods

238

239 Key Resources Table

240

Reagent or Resource

Source

Identifier

Deposited Data

MEG Data

This paper

N/A

Software and Algorithms

Matlab

Matlab

https://www.mathworks.com

Python

Python

https://www.python.org

E-prime 2

Psychology Software Tools, https://pstnet.com/products/e-

Inc., Sharpsburg, PA, USA prime/

FreeSurfer

https://surfer.nmr.mgh.harvar d.edu/

MNE

https://mne.tools/stable/index.

html

Custom code and algorithms This paper

https://github.com/Claudino/r

eplay

Other

Human healthy volunteers This paper

N/A

recruited from local area

CTF MEG 275 system

CTF MEG International

https://www.ctf.com

Services LP. Coquitlam, BC,

Canada

Cedrus LS-LINE

Cedrus Corporation. San Paolo, CA, USA

https://www.cedrus.com/lumi na/

GE Discovery MR750 3T GE Healthcare. Chicago, IL, https://www.gehealthcare.co

scanner system

USA

m/products/magnetic-

resonance-imaging/3-

0t/discovery-mr750

Siemens Skyra

Siemens Healthineers.

https://www.siemens-

Erlangen, Germany

healthineers.com/magnetic-

resonance-imaging/3t-mri-

scanner/magnetom-skyra

NIH HPC Biowulf Cluster NIH, Bethesda, MD, USA https://hpc.nih.gov/

241 242 243 Resource Availability 244 Lead Contact 245 Further information and requests for resources should be directed to and will be fulfilled by the 246 Lead Contact, Ethan R Buch (ethan.buch@nih.gov). 247 248 Materials Availability 249 This study did not generate new materials.

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
250 251 Data and Code Availability 252 Data (subject to participant consent) and analysis code used to generate the findings of this study 253 will be made freely available upon request to the Lead Contact, Ethan R Buch 254 (ethan.buch@nih.gov). 255 256 257 Experimental Model and Subject Details 258 259 Participants 260 Thirty-three na√Øve right-handed healthy participants (16 female, mean ¬± SEM age 26.6 ¬± 0.87) 261 with a normal neurological examination gave their written informed consent to participate in the 262 project, which was approved by the Combined Neuroscience Institutional Review Board of the 263 National Institutes of Health (NIH). Active musicians were excluded from the study 46. The sample 264 size was determined a priori via a power analysis of prior skill learning data collected in our 265 research group using the same task47, 48. Two participants were excluded before the start of analysis 266 because of technical problems with the MEG scanner during the recording sessions. One additional 267 participant was excluded due to large movement artefacts in the MRI scan required for source 268 modeling. 269 270 271 Methods 272 273 Behavior 274 275 Task. Participants performed a novel explicit motor skill sequence task where they repetitively 276 typed a 5-item numerical sequence displayed on a computer screen (41324) as quickly and as 277 accurately as possible. Keypresses were performed with the participant‚Äôs non-dominant, left hand 278 and applied to a response pad (Cedrus LS-LINE, Cedrus Corp). Keypress 1 was performed with 279 the little finger, keypress 2 with the ring finger, keypress 3 with the middle finger and keypress 4 280 with the index finger. The thumb was not used to respond. Individual keypress times and identities 281 were recorded for behavioral data analysis. Participants practiced the task for thirty-six (36), 10282 second duration trials. 10-second rest periods were interleaved between trials. During practice, 283 participants were instructed to fixate on the five-item sequence displayed for the full duration of 284 the trial. Small asterisks appeared above a sequence item when a keypress was recorded, providing 285 feedback to the participant about their current location within the sequence. After completion of a 286 full iteration of the sequence, the asterisks were removed. The asterisk display did not provide 287 error feedback, since they appeared for both correct and incorrect keypresses. During the 10288 second interleaved rest periods, the sequence was replaced with a string of five ‚ÄúX‚Äù symbols, 289 which participants were instructed to fixate on. Visual stimuli and task instructions were presented, 290 and keypress responses recorded using a custom script running in E-Prime 2 (Psychology Software 291 Tools, Inc.). 292 293 Skill measure calculation. Instantaneous correct sequence speed (skill measure) was quantified as 294 the inverse of time (in seconds) required to complete a single iteration of a correctly generated full 295 5-item sequence. Individual keypress responses were labeled as members of correct sequences if

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
296 they occurred within a 5-item response pattern matching any possible circular shifts of the 5-item 297 sequence displayed on the monitor (41324). This approach allowed us to quantify a measure of 298 skill within each practice trial at the resolution of individual keypresses and identify all possible 299 types of keypress response errors (i.e. ‚Äì omission, replication or substitution). Performance within 300 each trial was summarized as the median instantaneous correct sequence speed over the full trial. 301 302 Determination of the early learning trial cutoff. Here, early learning corresponds to the set of trials 303 between trial 1 and a cutoff trial, T, on which 95% of the performance gains are first achieved at 304 the group level. We determined T as follows. First, we fit the trial-by-trial group average correct 305 sequence speed data with an exponential model of the form: 306
307 308 309 where L(t) represents the group average learning state on practice trial, t, C1 and C2 control the pre310 training performance and asymptote (i.e. ‚Äì extent of learning), and Ì†µÌºÜ controls the learning rate. 311 Parameters C1 (boundry constraints = [0,5]), C2 ([0,15]) and Ì†µÌºÜ ([0,2]) were estimated using a 312 constrained nonlinear least squares method (MATLAB‚Äôs lsqcurvefit, trust-region-reflective 313 algorithm). Next, we accumulated L(t) (Eq. 1) over all $t$ and divided each trial's cumulative sum 314 by the area under the curve to obtain a trial-by-trial cumulative percentage of learning. Finally we 315 set T to the first trial where 95% of the learning had been achieved (T = 11 in this study). 316 317 Calculation of micro-online and micro-offline gains during early learning. We then assessed early 318 learning changes at the individual trial level by quantifying performance improvements occurring 319 during individual practice and rest periods. Micro-online learning was defined as the difference in 320 instantaneous correct sequence speed between the beginning and end of a practice trial. Micro321 offline learning was defined as the absolute difference in correct sequence speed between the end 322 of a practice period and the beginning of the subsequent practice period. Cumulative micro-online 323 and micro-offline learning scores measured over the first 11 trials for each participant were used 324 to assess their respective contribution to total early learning (i.e. - change in performance between 325 Trial 1 and Trial 11)8. 326 327 Magnetic resonance imaging (MRI) 328 329 MRI Acquisition. Structural MRI scanning was performed on a 3T MRI scanner (GE Excite HDxt 330 and Siemens Skyra) with a standard 32-channel head coil. T1-weighted high-resolution (1mm3 331 isotropic MPRAGE sequence) anatomical images were acquired for each participant. 332 333 Magnetoencephalography (MEG) 334 335 MEG Acquisition. Continuous MEG was recorded at a sampling frequency of 600Hz with a CTF 336 275 MEG system (CTF Systems, Inc., Canada) while participants were seated in an upright 337 position. The system is composed of a whole head array of 275 radial 1st-order gradiometer/SQUID 338 channels housed in a magnetically shielded room (Vacuumschmelze, Germany). Two of the 339 gradiometers were malfunctioning and were not used. A third channel was removed (MLT16340 1609) after visual inspection of the data indicated the presence of high noise levels for all

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
341 recordings, resulting in 272 total channels of MEG data. Synthetic 3rd order gradient balancing 342 was used to remove background noise online. A TTL trigger sent from the task computer to the 343 MEG data acquisition computer was used to temporally align the behavioral and MEG data. Head 344 position indicator (HPI) points were monitored in the scanner coordinate space using head 345 localization coils (HLCs) placed on the nasion, left and right pre-auricular locations of the 346 participant‚Äôs head. These coil positions were also recorded in the subject‚Äôs T1-MRI coordinate 347 space during the session using a stereotactic neuronavigation system (BrainSight, Rogue Research 348 Inc.). 349 350 MEG data preparation and pre-processing. Each participant‚Äôs MEG data were organized into the 351 following samples: pre-training rest (single segment of 5 min), inter-trial practice rest (36 352 segments of 10s), practice (36 segments of 10s) and post-training rest (single segment of 5 min). 353 All MEG samples were band-pass filtered between 1-100Hz, notch-filtered at 60Hz and subjected 354 to Independent Component Analysis (ICA). ICA was fit using MNE Python‚Äôs49 implementation of 355 FastICA50 after pre-whitening with Principal Component Analysis (set to retain the top 15 356 components). Spatial topographies and time series of all components were visually inspected and 357 those determined to be strongly associated with known electrocardiogram, eye movement and 358 blinks, and head movement artefacts were removed from the MEG sample. 359 360 MEG source reconstruction and parcellation. Source reconstruction of the MEG data was 361 performed using the standard pipeline in MNE Python51. A single forward solution and inverse 362 solution was calculated for each MEG sample. A boundary element model (BEM) required for 363 generation of the forward solution was constructed for individual subjects from inner-skull and 364 pial layer surfaces obtained by segmentation of the subject‚Äôs T1-MRI volume in FreeSurfer52. 365 Hippocampal surface labels were obtained by parcellating the participant‚Äôs MRI according to the 366 coordinates in the Brainnetome atlas50 (https://atlas.brainnetome.org/). Neocortical and 367 hippocampal source spaces were obtained by sampling the corresponding surfaces on a recursive 368 octahedral grid with 4.9mm between dipoles, and spatially aligned to the MEG sensor data with 369 the co-registration data obtained from BrainSight. The BEM was then used to generate the forward 370 solution at each source dipole location. The Linearly Constrained Minimum-Variance (LCMV) 371 beamformer operator was used to computer the inverse solution from the recorded MEG sensor 372 space data. The entire duration of each MEG sample was used to calculate the inverse solution 373 data covariance matrix. All inverse solutions used the same sample noise covariance matrix, which 374 was calculated over the first 20s of the pre-training rest MEG sample for individual subjects. 375 376 MNI-space transformations obtained from the FreeSurfer segmentation pipeline were then used to 377 spatially register the resulting source reconstruction time series to the Brainnetome atlas, enabling 378 quantitative estimation of millisecond-resolved brain activity for 212 neocortical and 4 379 hippocampal parcels (i.e. ‚Äì 216 total parcels). Parcel activity was estimated by averaging the time 380 series of all source dipoles falling within a given parcel boundary. A process called mean-flipping 381 was used to prevent within-parcel source cancellation when averaging. That is, the sign was flipped 382 for all sources with a sign that differed from that of the average source. Since the sensor space data 383 had been bandpass filtered with a cut-off frequency of 100Hz, the source data was downsampled 384 from 600Hz to 200Hz to increase computation speed in subsequent processing steps. All remaining 385 analyses were performed directly on the parcellated source-space MEG time series. 386

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
387 Training and evaluation of keypress decoders. Individualized keypress decoders were trained for 388 each participant using Python‚Äôs Scikit-learn library53. The training data of a subject‚Äôs decoder was 389 assembled as follows. We time-averaged the parcellated source for each correct keypress in all 36 390 practice MEG samples between t ¬± Dt ms, where t is the keypress timestamp and Dt is treated as a 391 cross-validated hyperparameter described in detail below. The timestamp for each keypress was 392 obtained from behavioral data files output by E-prime. This produced the predictor matrix 393 X[keypresses x parcels] and the target array y[keypresses x 1] where keypresses varied between subjects (some 394 typed more sequences than others) and parcels=216 as earlier described. 395 396 We used X and y to train four one-versus-all Radial-basis Support Vector Machines (Python Scikit397 learn‚Äôs SVC) with a pipeline parameterized with a feature centering/scaling policy, a time window 398 for averaging the MEG source around a keypress (Dt), a regularization term (C) and a kernel 399 coefficient (Œ≥). We solved for these (hyper)parameters by running 5-fold cross-validated grid400 search hyperparameter optimization three times, one for each of the following optimality criteria: 401
402 403 404 where Weight(key) = [2/7, 2/7, 2/7, 1/7] for keys 1, 2, 3 and 4, respectively, and Accuracy(key) = 405 percentage correct classification of key. For the second and third optimality criteria, classification 406 was done by picking the key that maximized the probability estimated by the SVCs, rather than 407 using the decision function. The search grid used was: C = [0.1, 0.5, 1, 10, 50, 100, 1000], 408 gamma=[0.05, 1/(2 x keypresses), 0.1, 0.5, 1], center policy = [True (will remove median), False 409 (will not not remove median)], standardization policy = [True (will divide by inter-quartile range 410 (IQR)), False (will not divide by IQR)] and Dt =[5, 10, 25] ‚Äì that is a total of 420 configurations. 411 SVCs were trained with a target error of 10-3 or less. 412 413 Three cross-validated grid searches were run for each participant, one for each of the three criteria: 414 F$$1$, BA and WBA. Grid search under a particular criterion worked as follows. First, the training 415 set was divided into 5 mutually exclusive stratified partitions so that the proportions of all 416 keypresses were preserved as in the original data (since the training sequence was 41324, each 417 folder would have approximately twice as many keys=4). Next, we used the random oversampler 418 in Python‚Äôs Imbalanced-learn toolbox54 (with a ‚Äúnot majority‚Äù sampling policy) to independently 419 oversamples keypresses 1, 2 and 3 within each training partition. Note that test partitions were 420 never oversampled, and training partitions did not share common oversampled patterns as this 421 would lead to double-dipping and ultimately overfitting. Finally, we performed the same 5-fold 422 cross-validation procedure on each of the 420 configurations in the grid. Each configuration 423 produced 5 estimates, resulting in a total of 2100 estimates. We then selected the decoder 424 configuration with the best cross-validated performance (data in test partitions only, and 425 performance under the considered optimality criterion) for each individual participant. To evaluate 426 the decoder‚Äôs performance, we created a null performance set by permuting the test labels (i.e. ‚Äì

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.

427 identities of all keypresses) 1000 times and calculating the decoder‚Äôs performance after each

428 permutation, leading to a p-value = (correct classifications + 1) / (1000 + 1). We also calculated

429 the decoder‚Äôs cross-validated confusion matrix, that is, the confusion matrix calculated over the

430 data in the cross-validated test partitions. This confusion matrix played an important role in our

431 replay detection pipeline as described later.

432

433 Estimation of decoder performance on practice sequence detection. The goal of the present step

434 was to select the best decoder for a participant on the basis of their estimated performance on full

435 practiced sequences. Recall that keypress decoder training resulted in three decoder options for 436 each participant (i.e. - $F$1$, BA and WBA) with associated cross-validated performances, p-values

437 and cross-validated confusion matrices. We used the following process to select the optimal

438 decoder for each participant. First, we discarded any decoder with a p-value >= 0.05. This step

439 resulted in at least one viable decoder for all participants. Next, we reshaped each participants‚Äô

440 predictor matrix XPractice[keypresses x parcels] back into the correctly typed sequences they originated 441 from, resulting in an associated array XPractice[5 x parcels x N] for each subject, where N is the number

442 of correctly typed sequences of 4-1-3-2-4.

443

444 We then evaluated the ability of the decoders to correctly identify each typed practice sequence

445 from j=1‚Ä¶N using the following procedure:

446

447

1. Scored the probability, Ì†µÌ±ù!"#[Ì†µÌ±ó], of XPractice[:, :, j] being identified as sequence 4-1-3-2-4 as the

448

product of the probabilities of each of the sequence‚Äôs constituent keys, Ì†µÌ±ù$"%(‚ãÖ), in the

449

correct order. Probabilities Ì†µÌ±ù$"%(‚ãÖ) were obtained from the keypress SVC decoders for each

450

subject.

451

452

2. Repeated Step 1 for all other possible sequences (i.e. ‚Äì all other 1023 5-digit combinations

453

of 1,2,3 and 4). Combined, these sequences form the set of null probabilities, Œ©.

454

455

3. From Œ©, we calculated the p-value for detection of the j-th practiced sequences as

456

p-value = 1 ‚àí Ì†µÌ±ùÌ†µÌ±íÌ†µÌ±üÌ†µÌ±êÌ†µÌ±íÌ†µÌ±õÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ôÌ†µÌ±í&(Ì†µÌ±ù!"#[Ì†µÌ±ó])/100 and counted a detection of typed sequence j if

457

the p-value < 0.05.

458

459 Finally, we obtained the sequence detection rate of a decoder by dividing the number of detections

460 by the total number of practiced sequences, N. We then selected the decoder option with the top

461 detection rate for sequences observed in the practice data. Fig. S5A shows the distribution of top

462 detection rates across participants. Fig. S5B shows keypress probabilities first averaged at each

463 ordinal position of detected practice sequences and then averaged over subjects. Note that the

464 expected key at each position is always the keypress with the top detection probability. All

465 participants had at least one decoder with a non-zero detection rate. The selected decoder was the

466 one used to interrogate waking rest MEG data samples for replay events.

467

468 Sequence replay detection and replay rate calculation. Given a rest period MEG sample, XRest [T

469 x parcels], of T time-points x parcels recorded from a given subject, we estimated the probability

470 that a given sequence, seq=ABCDE, was replayed at a time 0 ‚â§ t < T within that sample to be the

471 product of the probabilities of each of the sequence‚Äôs constituent keys A, B, C, D and E ‚àà [1, 2,

472 3, 4] being observed both in the right order and ending at time t, that is:

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
473
474 475 476 Where Xrsp = resample(XRest[t ‚àí 5 ‚àô tscl + 1 ‚à∂ Ì†µÌ±°, : ]) is an MEG sample segment extracted from 477 t ‚àí 5 ‚àô tscl + 1 to Ì†µÌ±° at all 216 parcels and compressed down to 5 time-points. Probabilities of 478 different replay durations were obtained by varying the timescale compression factor, tscl, where 479 Ì†µÌ±°Ì†µÌ±†Ì†µÌ±êÌ†µÌ±ô ‚àà [1, ‚Ä¶ ,10,15,20,30,40,80,100]. 480 481 For example, since our time resolution is 5ms, we set tscl = 1 to look for 25ms replay durations, 482 tscl = 2 for 50ms replay durations, and up to as high as tscl = 100 for 2500ms durations. In terms 483 of implementation, we obtained Ì†µÌ∞ó*!+ using Python‚Äôs scipy resample with default arguments and 484 num=5. Again, probabilities Ì†µÌ±ù$"%(‚ãÖ) were obtained from the keypress SVC decoders selected for 485 each subject. Scikit-learn implements a multiclass version of Platt‚Äôs scaling technique to obtain 486 probability distributions from classifications over more than two classes55. 487 488 We only assessed replay likelihood at time-points where Ì†µÌ±ù!"#,-./01[Ì†µÌ±°] exceeded a threshold, Ì†µÌºÉ!"#, 489 set to the product of the maximum off-diagonal detection rates (i.e. false positive rates) of the 490 keypress decoder's cross-validated confusion matrix. For each time-point, t, such that 491 Ì†µÌ±ù!"#,-./01[Ì†µÌ±°] > Ì†µÌºÉ!"#, we then tested the associated statistical significance as to ‚Äúhow rare" 492 Ì†µÌ±ù!"#,-./01[Ì†µÌ±°] would be under the null distribution of probabilities for all other 1,023 possible 493 decodable sequences (i.e. ‚Äì the Œ© set) resulting in a p-value = 1 ‚àí Ì†µÌ±ùÌ†µÌ±íÌ†µÌ±üÌ†µÌ±êÌ†µÌ±íÌ†µÌ±õÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ôÌ†µÌ±í&(Ì†µÌ±ù!"#[Ì†µÌ±°])/100. All 494 p-values were FDR-corrected (Benjamin-Hochberg) to account for multiple comparisons using an 495 Ì†µÌªº = 0:05 with the number of tests set to the size of Œ©. By pre-selecting which time-points to test, 496 we mitigated underpowering effects of correcting for multiples comparisons. Note that the 497 selection threshold Ì†µÌºÉ!"# was fully determined from practice data (cross-validated confusion 498 matrices) and never from test data on which statistical testing was carried out, therefore eliminating 499 the possibility of circular analysis or double-dipping. Statistically significant replay detections 500 were marked for all p-value[t] < 0.05. Since it was possible that overlapping Xrsp[t] could result in 501 multiple detections of the same putative replay event, each set of multiple detections occurring 502 (within the same tested replay duration) was replaced with a single detection at the median time 503 instant of the set. Finally, we scored the replay rate of seq during the given rest period MEG sample 504 as the number of detections per the sample's duration in seconds: 505
506 507 508 where Ì†µÌ±êÌ†µÌ±úÌ†µÌ±¢Ì†µÌ±õÌ†µÌ±°Ì†µÌ±†(‚ãÖ) is the number of detections of seq along the timeline of the MEG sample, and fs 509 is the sampling rate of the MEG sample (i.e. ‚Äì fs/T is the inverse of the duration of the sample in 510 seconds). 511 512 Replay Network Characterization. 513 While use of a nonlinear kernel optimized the performance of the keypress state decoders, it 514 precludes direct assessment of the spatial representations of these states (and sequence dynamics) 515 from the decoder weights. However, since the output of the replay detection pipeline specifies the 516 time-point at which individual replay events are initiated and what their duration is, it is possible

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
517 to gain insight into replay network dynamics by interrogating these event epochs. After averaging 518 all 50ms forward replay (i.e. . ‚Äì 41324) event epochs, we performed principal component analysis 519 (PCA) to extract low-dimensional networks displaying strong covariation in source power during 520 replay. We mapped the membership coefficients for cortical regions onto the FreeSurfer average 521 brain, and the four hippocampal subregions onto a separate surface representation. The thresholded 522 maps display the top 10% of PC loading coefficient magnitudes (i.e ‚Äì absolute value of signed 523 coefficients). 524 525 Correlation of Replay Rates with Behavior. 526 We performed Pearson correlation analyses of the average forward and reverse trained sequence 527 replay rates detected during the first eleven 10-second waking rest periods with cumulative micro528 offline learning over the same period. We also performed a control analysis by the assessing the 529 correlation between replay of a single alternative sequence (33433) with with cumulative micro530 offline learning over trials 1-11. This is the only alternative sequence (1 out of 1022) which does 531 not share any common ordinal position or transition structure with the forward and reverse of the 532 trained sequence. 533 534 Acknowledgements 535 This research was supported by the Intramural Research Program of the NIH, NINDS. We thank 536 I√±aki Ituratte for helpful comments on manuscript drafts. 537 538 539 Author Contributions 540 E.R.B. conceived of the presented idea. M.B. and L.G.C. conceived of and designed the 541 experiment. M.B. carried out the experiment. L.C. conceived of and developed the MEG analysis 542 pipeline. R.Q. assisted with refinement of the MEG analysis pipeline. E.R.B. and L.C. carried out 543 the analyses. E.R.B., L.G.C. and L.C. wrote the manuscript. M.B. and R.Q. reviewed and edited 544 the manuscript. 545 546 547

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.

548 References

549

550

551 1. Dayan E, Cohen LG. Neuroplasticity subserving motor skill learning. Neuron 72, 443-

552

454 (2011).

553

554 2. Kornmeier J, Sosic-Vasic Z. Parallels between spacing effects during behavioral and

555

cellular learning. Front Hum Neurosci 6, 203 (2012).

556

557 3. Song S, Sharma N, Buch ER, Cohen LG. White matter microstructural correlates of

558

superior long-term skill gained implicitly under randomized practice. Cereb Cortex 22,

559

1671-1677 (2012).

560

561 4. Gerbier E, Toppino TC, Koenig O. Optimising retention through multiple study

562

opportunities over days: The benefit of an expanding schedule of repetitions. Memory 23,

563

943-954 (2015).

564

565 5. Toppino TC, Cohen MS, Davis ML, Moors AC. Metacognitive control over the

566

distribution of practice: when is spacing preferred? J Exp Psychol Learn Mem Cogn 35,

567

1352-1358 (2009).

568

569 6. Cepeda NJ, Pashler H, Vul E, Wixted JT, Rohrer D. Distributed practice in verbal recall

570

tasks: A review and quantitative synthesis. Psychol Bull 132, 354-380 (2006).

571

572 7. Robertson EM. Skill Memory: Mind the Ever-Decreasing Gap for Offline Processing.

573

Curr Biol 29, R287-R289 (2019).

574

575 8. Bonstrup M, Iturrate I, Thompson R, Cruciani G, Censor N, Cohen LG. A Rapid Form of

576

Offline Consolidation in Skill Learning. Curr Biol 29, 1346-1351 e1344 (2019).

577

578 9. Jacobacci F, et al. Rapid hippocampal plasticity supports motor sequence learning. Proc

579

Natl Acad Sci U S A 117, 23898-23903 (2020).

580

581 10. Bonstrup M, Iturrate I, Hebart MN, Censor N, Cohen LG. Mechanisms of offline motor

582

learning at a microscale of seconds in large-scale crowdsourced data. NPJ Sci Learn 5, 7

583

(2020).

584

585 11. Karni A. When practice makes perfect. Lancet 345, 395 (1995).

586

587 12. Karni A, et al. The acquisition of skilled motor performance: fast and slow experience-

588

driven changes in primary motor cortex. Proc Natl Acad Sci U S A 95, 861-868 (1998).

589

590 13. Walker MP, Brakefield T, Hobson JA, Stickgold R. Dissociable stages of human memory

591

consolidation and reconsolidation. Nature 425, 616-620 (2003).

592

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.

593 14. 594 595 596 15. 597 598 599 16. 600 601 602 17. 603 604 605 18. 606 607 608 19. 609 610 611 20. 612 613 614 21. 615 616 617 618 22. 619 620 621 23. 622 623 624 24. 625 626 627 25. 628 629 630 26. 631 632 633 27. 634 635 636 637 28. 638

Song S, Cohen LG. Practice and sleep form different aspects of skill. Nat Commun 5, 3407 (2014).
Carr MF, Jadhav SP, Frank LM. Hippocampal replay in the awake state: a potential substrate for memory consolidation and retrieval. Nat Neurosci 14, 147-153 (2011).
Albouy G, et al. Maintaining vs. enhancing motor sequence memories: respective roles of striatal and hippocampal systems. Neuroimage 108, 423-434 (2015).
Foster DJ, Wilson MA. Reverse replay of behavioural sequences in hippocampal place cells during the awake state. Nature 440, 680-683 (2006).
Diba K, Buzsaki G. Forward and reverse hippocampal place-cell sequences during ripples. Nat Neurosci 10, 1241-1242 (2007).
Singer AC, Frank LM. Rewarded outcomes enhance reactivation of experience in the hippocampus. Neuron 64, 910-921 (2009).
Ramanathan DS, Gulati T, Ganguly K. Sleep-Dependent Reactivation of Ensembles in Motor Cortex Promotes Skill Consolidation. PLoS Biol 13, e1002263 (2015).
Karni A, Meyer G, Jezzard P, Adams MM, Turner R, Ungerleider LG. Functional MRI evidence for adult motor cortex plasticity during motor skill learning. Nature 377, 155158 (1995).
Buzsaki G, Tingley D. Space and Time: The Hippocampus as a Sequence Generator. Trends Cogn Sci 22, 853-869 (2018).
Margulies DS, et al. Precuneus shares intrinsic functional architecture in humans and monkeys. Proc Natl Acad Sci U S A 106, 20069-20074 (2009).
Ebbinghaus H. Memory: a contribution to experimental psychology. Ann Neurosci 20, 155-156 (2013).
Liu Y, Dolan RJ, Kurth-Nelson Z, Behrens TEJ. Human Replay Spontaneously Reorganizes Experience. Cell 178, 640-652 e614 (2019).
Davidson TJ, Kloosterman F, Wilson MA. Hippocampal replay of extended experience. Neuron 63, 497-507 (2009).
Papaxanthis C, Pozzo T, Skoura X, Schieppati M. Does order and timing in performance of imagined and actual movements affect the motor imagery process? The duration of walking and writing task. Behav Brain Res 134, 209-215 (2002).
Marchesotti S, Bassolino M, Serino A, Bleuler H, Blanke O. Quantifying the role of motor imagery in brain-machine interfaces. Sci Rep 6, 24076 (2016).

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.

639 640 29. 641 642 643 644 30. 645 646 647 31. 648 649 650 32. 651 652 653 33. 654 655 656 34. 657 658 659 35. 660 661 662 36. 663 664 665 666 37. 667 668 669 38. 670 671 672 39. 673 674 675 40. 676 677 678 41. 679 680 681 42. 682 683 684

Fernandez-Ruiz A, Oliva A, Fermino de Oliveira E, Rocha-Almeida F, Tingley D, Buzsaki G. Long-duration hippocampal sharp wave ripples improve memory. Science 364, 1082-1086 (2019).
Karlsson MP, Frank LM. Awake replay of remote experiences in the hippocampus. Nat Neurosci 12, 913-918 (2009).
Schacter DL, Benoit RG, Szpunar KK. Episodic Future Thinking: Mechanisms and Functions. Curr Opin Behav Sci 17, 41-50 (2017).
Dragoi G, Tonegawa S. Preplay of future place cell sequences by hippocampal cellular assemblies. Nature 469, 397-401 (2011).
Dragoi G, Tonegawa S. Distinct preplay of multiple novel spatial experiences in the rat. Proc Natl Acad Sci U S A 110, 9100-9105 (2013).
Gupta AS, van der Meer MA, Touretzky DS, Redish AD. Hippocampal replay is not a simple function of experience. Neuron 65, 695-705 (2010).
Behrens TEJ, et al. What Is a Cognitive Map? Organizing Knowledge for Flexible Behavior. Neuron 100, 490-509 (2018).
Farooq U, Sibille J, Liu K, Dragoi G. Strengthened Temporal Coordination within Preexisting Sequential Cell Assemblies Supports Trajectory Replay. Neuron 103, 719-733 e717 (2019).
Wong AL, Krakauer JW. Why Are Sequence Representations in Primary Motor Cortex So Elusive? Neuron 103, 956-958 (2019).
Yokoi A, Diedrichsen J. Neural Organization of Hierarchical Motor Sequence Representations in the Human Neocortex. Neuron 103, 1178-1190 e1177 (2019).
Squire LR, Zola-Morgan S. The medial temporal lobe memory system. Science 253, 1380-1386 (1991).
Dudai Y. The neurobiology of consolidations, or, how stable is the engram? Annu Rev Psychol 55, 51-86 (2004).
Alvarez P, Squire LR. Memory consolidation and the medial temporal lobe: a simple network model. Proc Natl Acad Sci U S A 91, 7041-7045 (1994).
Whittington JCR, et al. The Tolman-Eichenbaum Machine: Unifying Space and Relational Memory through Generalization in the Hippocampal Formation. Cell 183, 1249-1263 e1223 (2020).

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.

685 43. 686 687 688 44. 689 690 691 45. 692 693 694 46. 695 696 697 47. 698 699 700 48. 701 702 703 49. 704 705 706 50. 707 708 709 51. 710 711 712 52. 713 714 53. 715 716 717 54. 718 719 720 721 55. 722 723 724

Gonzalez Castro LN, Monsen CB, Smith MA. The binding of learning to action in motor adaptation. PLoS Comput Biol 7, e1002052 (2011).
Eldar E, Lievre G, Dayan P, Dolan RJ. The roles of online and offline replay in planning. Elife 9, (2020).
de Sousa AF, et al. Optogenetic reactivation of memory ensembles in the retrosplenial cortex induces systems consolidation. Proc Natl Acad Sci U S A 116, 8576-8581 (2019).
Abraham A, et al. Machine learning for neuroimaging with scikit-learn. Front Neuroinform 8, 14 (2014).
Censor N, Dayan E, Cohen LG. Cortico-subcortical neuronal circuitry associated with reconsolidation of human procedural memories. Cortex 58, 281-288 (2014).
Censor N, Horovitz SG, Cohen LG. Interference with existing memories alters offline intrinsic functional brain connectivity. Neuron 81, 69-76 (2014).
Gramfort A, et al. MEG and EEG data analysis with MNE-Python. Front Neurosci 7, 267 (2013).
Fan L, et al. The Human Brainnetome Atlas: A New Brain Atlas Based on Connectional Architecture. Cereb Cortex 26, 3508-3526 (2016).
Gramfort A, et al. MNE software for processing MEG and EEG data. Neuroimage 86, 446-460 (2014).
Fischl B. FreeSurfer. Neuroimage 62, 774-781 (2012).
Pedregosa F, et al. Scikit-learn: Machine Learning in Python. Journal of Machine Learning Research 12, 2825-2830 (2011).
Lemaitre G, Nogueira F, Aridas C. Imbalanced-learn: A Python Toolbox to Tackle the Curse of Imbalanced Datasets in Machine Learning. . Journal of Machine Learning Research 18(17), 1-5 (2017).
Wu T, Lin C, Weng RC. Probability estimates for multi-class classification by pairwise coupling. . Journal of Machine Learning Research 5, 975-1005 (2004).

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
725 FIGURES
726 727 Figure 1. Skill learning task and behavioral performance. (A) Keypress sequence motor skill 728 task. Subjects acquired a novel motor skill over a single training session. They were instructed to 729 repeatedly type a trained sequence, 41324, with the left non-dominant hand as fast and as 730 accurately as possible. Keypress 4 was performed with the left index finger, Keypress 3 with the 731 left middle finger, Keypress 2 with the left ring finger and Keypress 1 with the left little finger. 732 Following task instructions, a 5-minute MEG waking rest recording was acquired prior to 733 commencement of training (Pre-training rest). Subjects then performed the task over 36 individual 734 practice periods lasting 10s each. Practice periods were interleaved with 10s waking rest intervals 735 (Inter-practice rest). MEG was acquired continuously during training (12 minutes). A second, 5736 minute waking rest MEG recording was acquired after training concluded (Post-training rest). (B) 737 Performance curve. Skill was measured as the correct sequence typing speed (sequences per 738 second, seq/s). Mean average performance (mean ¬± SEM) increased rapidly during early learning 739 (the set of trials within which 95% of total learning occurred, trials 1-11; vertical dashed line). (C) 740 Instantaneous correct sequence typing speed (group mean ¬± SEM shown) was used to quantify 741 micro-online performance gains during practice (cyan) and micro-offline gains during interleaved 742 rest (magenta) for the early learning period. (D) Micro-online (cyan), micro-offline (magenta), and 743 total early learning (green) for each subject. Note that skill increases occur during intervening 744 periods of waking rest, and not during active practice.

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
745 746 Figure 2. Replay detections. (A) Replay detection analysis pipeline. Raw MEG data was pre747 processed, source-localized and parcellated into 216 brain regions using the Brainnetome Atlas50. 748 Practice data segments centered on individual keypress events were used to train four one-versus749 all Radial-basis Support Vector Machine keypress state decoders (i.e. ‚Äì one decoder per finger). 750 We then used the trained keypress state decoders to interrogate resting-state MEG data (preceding 751 training, during rest periods interspersed with practice, and after the end of training) at each time752 point, T, for replay of keypress state sequences over a range durations (25-2500ms) corresponding 753 to temporal compression ranges (0.4-40x) previously reported26, 27, 28. Decoder performance 754 evaluation (Fig. S1) was used to threshold minimum detectable sequence replay probabilities. 755 Permutation testing against probabilities for all possible sequences (n=1024) at time-point T was 756 used to determine statistically significant detection of keypress sequence replay events. (B) Neural 757 replay was detected during waking rest. (A) The maximum forward trained sequence replay rate

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
758 was observed for events of 50ms duration. This was consistent with observed replay for the reverse 759 trained sequence (Fig. S2A). (C) Waking replay rates (50ms duration) for the forward trained 760 sequence more than tripled during inter-practice rest (2.44¬±0.29; Mean¬±SEM) relative to pre761 training rest (0.75¬±0.21). Similar magnitude rate changes were also observed for the reverse 762 trained sequence (Fig. S2B). Replay rates then receded during post-training rest (0.88¬±0.21) to 763 levels similar to pre-training. (D) Within individuals, waking replay increased more prominently 764 (F2,87=6.42; p=0.002) after practice onset for the forward (41324; left; p=0.0062, Bonferroni765 corrected) and reverse (42314; middle; p=0.0099, Bonferroni-corrected) trained sequence than for 766 a control sequence (33433; right). This control was selected on the basis that it was the only one 767 out of 1,022 possible alternate sequences sharing no common ordinal position or transition 768 structure with the forward (41324) and reverse (42314) trained sequence. Pre-training rest replay 769 rates did not significantly differ between these sequences (F2,53.94=2.431; p 0.098). Of note, this 770 same trend was observed even after expanding this criteria to consider additional sequences 771 sharing either a single common ordinal position or a single common transition with the practice 772 sequence (Fig. S2C).

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
773 774
775 776 Figure 3. Spatial features of detected replay events. Principal component analysis (PCA) was 777 used to characterize networks with covarying power changes in parcellated MEG source-space 778 during group average replay events. Together, PC1 and PC2 explain 86.6% of the total power779 related variance during replay. PC1, shown here, explains 67.8% of the total variance alone and is 780 characterized by a positively correlated sensorimotor-entorhinal-hippocampal network. PC2 781 displays a similar set of regions (Fig. S4). Surface maps are thresholded to display the highest 782 loading parcels (see Methods).

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
783 784 Figure 4. Forward and reverse neural replay of the trained sequence predict rapid wakeful 785 skill consolidation. The above scatter plots depict inter-individual replay rates over all early 786 learning inter-practice rest periods (abscissa) relative to cumulative micro-offline gains (ordinate) 787 over the same time window (Trials 1-11). (A,B) Significant correlations were observed for both 788 forward (A; r=0.451, p=0.012) and reverse (B; r=0.521, p=0.003) replay of the trained sequence. 789 Thus, higher rates of replay related to the trained sequence predicted greater micro-offline gains 790 and rapid wakeful skill consolidation in individuals. (C) Conversely, replay during inter-practice 791 rest of the control sequence (33433) did not display a significant correlation with rapid wakeful 792 skill consolidation (r=0.165, p=0.38) during early learning. 793

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
794 SUPPLEMENTARY FIGURES 795 796
797 798 Figure S1. Subject-average confusion matrices of key press decoders calculated over training 799 examples (average true positive rates ranged between 60.2-68.5%). Cross-validated 800 performance of all selected decoders exceeded chance levels (Random permutation test, N=1000, 801 Ì†µÌªº=0.05). Please see Methods: Magnetoencephalography: Training and evaluation of keypress 802 decoders for complete details.

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
803 804 Figure S2. Reverse trained sequence replay detections. (A) The maximum reverse trained 805 sequence replay rate was observed for events of 50ms duration. This was consistent with observed 806 replay for the forward trained sequence (Fig. 2B). (B) Waking reverse replay rates (50ms-duration) 807 for the forward trained sequence more than tripled during inter-practice rest (2.36¬±0.31) relative 808 to pre-training rest (0.73¬±0.21). Similar magnitude rate changes were also observed for the forward 809 trained sequence (Fig. 2C). Replay rates then receded during post-training rest (0.88¬±0.21) to 810 levels similar to pre-training. (C) Forward and reverse replay of the trained sequence increased 811 more prominently than all members of an expanded control sequence set after practice onset. 812 Comparisons were limited to sequences sharing no common ordinal position or transition structure 813 (n=1; 33433), or only a single common ordinal position (n=3; 11212, 12221, 21211) or transition 814 (n=3; 13131, 23232, 23233). Importantly, pre-training rest replay rates did not significantly differ 815 between these sequences (F8,108.48=0.654; p 0.73).

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.

816

817

818

A

B

C

Inter-practice rest period (n)

D

819 820 Figure S3. Temporal features of waking replay events during inter-practice rest. (A) High 821 replay rates centered around 2.5/sec were detected over all 35 waking inter-practice rest periods. 822 (B) Raster plot of inter-practice replay events (50ms duration) shown for a representative subject. 823 (C) Histogram of replay event occurences summed across all 35 inter-practice periods for all 824 subjects. Consistent with (B), replays events were uniformly distributed across the entire 10825 second rest interval. (D) Histogram showing the inter-replay intervals (i.e. ‚Äì time between 826 successive replay detections in ms) across all 50ms replay events in all subjects. The predominance 827 of very short inter-replay intervals confirms that inter-practice rest replay events tend to occur in 828 temporal clusters, consistent with the raster plot in B.

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
829 830 Figure S4. Spatial features of detected replay events. We performed principal component 831 analysis (PCA) to characterize networks with covarying power changes in parcellated MEG 832 source-space. PC2, shown here, explains 18.8% of the total power-related variance during group 833 average replay events. Similar to PC1 (Fig. 3), PC2 and is characterized by strong covariations in 834 power within a sensorimotor-entorhinal-hippocampal network. 835

bioRxiv preprint doi: https://doi.org/10.1101/2021.04.07.438819; this version posted April 7, 2021. The copyright holder for this preprint (which was not certified by peer review) is the author/funder. This article is a US Government work. It is not subject to copyright under 17 USC 105 and is also made available for use under a CC0 license.
836
837 838 Figure S5. Estimation of decoder performance on practice sequence detection. (A) 839 Distribution of sequence detection rates (percent of practice sequences correctly decoded from 840 MEG activity only) over subjects. (B) Keypress state probabilities averaged at each ordinal 841 position over detected practice sequences for all subjects (mean¬± SEM). Note that the maximum 842 keypress state probability at each ordinal position correctly reconstructs the trained sequence (i.e. 843 ‚Äì 41324). (C, D, E) Keypress state probabilities averaged at each ordinal position over all detected 844 trained sequence replay events for all subjects (mean¬± SEM) during (C) Pre-training rest, (D) 845 Inter-practice rest and (E) Post-training rest. Again, note that on average the maximum keypress 846 state probability at each ordinal position is capable of decoding the full trained sequence (i.e. ‚Äì 847 41324) for replay events during waking rest.

