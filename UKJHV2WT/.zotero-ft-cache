Brief Communication
https://doi.org/10.1038/s41593-021-00804-w

Integrating new memories into the hippocampal network activity space
Giuseppe P. Gava   1,2, Stephen B. McHugh1, Laura Lefèvre1, Vítor Lopes-dos-Santos1, Stéphanie Trouche1, Mohamady El-Gaby   1, Simon R. Schultz   1,2 ✉ and David Dupret   1 ✉

By investigating the topology of neuronal co-activity, we
found that mnemonic information spans multiple operational
axes in the mouse hippocampus network. High-activity princi-
pal cells form the core of each memory along a first axis, seg-
regating spatial contexts and novelty. Low-activity cells join
co-activity motifs across behavioral events and enable their
crosstalk along two other axes. This reveals an organizational
principle for continuous integration and interaction of hippo-
campal memories.
Assimilating new knowledge without corrupting acquired memories is critical. However, learning and memory interact: prior knowledge can proactively influence ongoing learning, and new information can retroactively modify pre-existing memories. The hippocampus is a brain region supporting memory1, but the network-level operations that continuously incorporate new experiences, segregating them as discrete traces while enabling their interaction, are unknown. The discovery that hippocampal principal cells are tuned to the animal’s position and surrounding cues provides an important mechanistic foundation for the role of the hippocampus in memory, with each environment recruiting a discrete combination of neurons expressing a map-like representation of that space1,2. Although this suggests how the hippocampus disentangles the spatial contexts of different memories, these representations further involve the fine-grained temporal coordination of neuronal spiking3,4. Notably, sets of jointly active neurons organize motifs of co-activity (co-firing patterns), some of which underpin spatially selective assemblies5. Here we hypothesize that an adaptive topological reorganization of co-activity motifs enables embedding of new memory items in the hippocampal network.
We monitored dorsal CA1 (dCA1) ensembles from mice exploring a familiar environment before and after associating a novel environment with reward (sucrose), using a 1-d conditioned place preference (CPP) task (Fig. 1a and Extended Data Fig. 1a). Each day, mice first explored the familiar enclosure (exposure). Next, we identified the preference of each mouse for one of the two novel compartments connected by a bridge to form the CPP enclosure that day (pre-test). We subsequently removed that bridge in conditioning sessions where each mouse explored its non-preferred compartment baited with drops of a sucrose solution (+Suc.) and then the preferred compartment with drops of water (+Wat.). One hour after the last conditioning session, we re-inserted the bridge and tested CPP memory (CPP test; Extended Data Fig. 1b). To assess the effect of new CPP memory on prior representations, we finished each recording day by re-exposing mice to the familiar enclosure (re-exposure).

On each day, we recorded neuronal spiking throughout the six CPP task sessions (Fig. 1a; n = 1,083 total principal cells, 63.7 ± 33.2 principal cells per day, 17 d from seven mice). Using the spike trains recorded during active exploration (that is, excluding immobility epochs and sharp-wave/ripples (SWRs)), we computed weighted graphs6,7 to explore the firing relationships among sets of co-active neurons in each task session (Fig. 1b–e; n = 102 graphs and 260,058 co-firing pairs). In these co-firing graphs, each node represents one cell; the edge linking any two nodes represents the co-activity of that cell pair, with a weight computed as the Pearson correlation coefficient between their spike trains. For each graph, this procedure yielded an adjacency matrix of pairwise co-firing coefficients, with dimensions equal to the number of nodes (Fig. 1c and Extended Data Fig. 1c).
We observed that co-firing graphs include more triads of co-active nodes during CPP learning (Fig. 1f; Clustering coefficient), showing that associating a novel place with reward changes the co-activation structure of the network. Concomitantly, the average geodesic path length, calculated as the mean shortest path between any two nodes, decreases (Fig. 1f; Geodesic path length), indicating greater functional connectivity between sets of co-active neurons. By calculating for each node the summed weight of all its edges in the adjacency matrix, we also found that the average single-neuron cumulative co-firing increases (Fig. 1f; Co-firing strength), reporting heightened firing associations among neurons during CPP learning. Similar topological deviations from the co-firing network featuring the familiar context during exposure occurred during exploration of a novel context (without reward), spontaneous preference for a novel place and reward experience in an otherwise familiar context (without CPP) (Extended Data Fig. 2), suggesting a general mechanism for integrating new information. Notably, however, these topological deviations did not reset during re-exposure 1 h after CPP (Fig. 1f), whereas they did in the other tasks (Extended Data Fig. 2). These sustained changes after CPP reflected neither differences in exploration nor simple fluctuations in co-firing (Extended Data Fig. 3). Thus, the mnemonic operation of updating a recently encountered place with reward caused an enduring topological reorganization (‘hysteresis’) in the co-activity structure of the network.
We next asked whether the topological hysteresis caused by CPP on the co-firing motifs expressed in the familiar enclosure (Fig. 1f) affected its spatial representation. By computing the firing maps of individual neurons in each task session (Fig. 2a), we found that both single-neuron and population-level maps featuring exposure reorganized in the CPP enclosure to then largely re-emerge during re-exposure (Extended Data Fig. 4a,b). However, despite their

1Medical Research Council Brain Network Dynamics Unit, Nuffield Department of Clinical Neurosciences, University of Oxford, Oxford, UK. 2Department of Bioengineering and Centre for Neurotechnology, Imperial College London, London, UK. ✉e-mail: s.schultz@imperial.ac.uk; david.dupret@bndu.ox.ac.uk

326

Nature Neuroscience | VOL 24 | March 2021 | 326–330 | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

a
Exposure

Pre-test

+ Suc. + Wat. CPP test

f
Re-exposure

Fam 1 Nov 1 Nov 2 Nov 1 Nov 2 Nov 1 Nov 2 Fam 1

Brief Communication

Exposure Pre-test

+ Suc. + Wat. CPP test Re-exposure

Trajectory Enclosure Session

Ð0.37

0.30

b 68

No. of principal cells

0

0

Time (s)

20

c

Co-firing coefficient (r )

d

Ð0.1

0.4

0

No. of principal cells

68 0No. of principal cell6s8

e

Exposure

Pre-test

CPP test

Re-exposure

Co-firing strength

Geodesic path length

Clustering coefficient

Median ∆

Median ∆

Median ∆

1
0 Ð0.2 0.15
0 Ð0.05
100 10Ð1 10Ð2 0.05
0
Ð0.15
1
0 Ð0.4 0.15
0 Ð0.05

Pre-test minus exposure

+Suc minus exposure

+Wat. minus exposure

CPP test Re-exposure

minus

minus

exposure exposure

Fig. 1 | New CPP memory reorganizes pre-existing hippocampal co-firing topology. a, CPP task layout. Each day, mice explored the same familiar enclosure before and after a four-session CPP task. Mouse trajectory in each session from 1 d is shown below the schematic of in-use enclosures. Numbers indicate place preference scores for pre-test and test, as the time in sucrose-paired compartment (+Suc.) minus that in water-paired compartment (+Wat.) over the sum. During the CPP test, the mouse successfully changed its initial preference for the sucrose-paired compartment, as indicated by the positive score. b, Example raster plot showing the spike trains of 68 simultaneously recorded dCA1 principal cells (one cell per row) for the day shown in a. For clarity, a 20-s sample is shown. c, The corresponding adjacency matrix of the pairwise correlation coefficients measuring the co-firing of principal cells. d, The corresponding co-firing graph. Each node represents one cell. Each edge represents the co-firing association of one cell pair, color-coded according to their correlation’s sign and width proportional to the edge’s absolute value. e, Example adjacency matrices (top row) and corresponding neuronal motifs (bottom row) extracted from the graph shown in d to visualize some co-firing changes across sessions. f, Changes in topological clustering (top), geodesic path length (middle) and single-neuron cumulative co-firing strength (bottom) of co-firing graphs. For each measure, the entire dataset is presented using a Cumming estimation plot to visualize the effect size. Each top panel shows the distribution of raw data points (each point represents one cell) for each color-coded session (with the gapped lines on the right as mean (gap) ± s.d. (vertical ends) for each session). Each bottom panel displays the difference between a given session and the exposure, computed from 5,000 bootstrapped re-samples and with difference-axis origin aligned to the median of the exposure distribution. For each task session: black dot, median; black ticks, 99% confidence interval; filled curve: sampling error distribution.

reinstatement during re-exposure after CPP, familiar maps seemed edited beyond mere fluctuations in neuronal activity (Extended Data Fig. 4c–g).
These results indicate that new CPP memory re-structured the prior representation of the familiar environment. To discern the

effect of this crosstalk, we analyzed the transformation of co-firing graphs within the ‘network activity space’. We computed the topological distances separating graphs across the six CPP task sessions (Fig. 1a) using the Riemannian log-Euclidean metric. For the co-firing adjacency matrix of each session, this procedure yielded a

Nature Neuroscience | VOL 24 | March 2021 | 326–330 | www.nature.com/natureneuroscience

327

Brief Communication

a
Exposure 8.2
6.5

Pre-test

+Suc. +Wat.

4.6

3.8

3.3

14

1

4.8

b

CPP test Re-exposure

12

7.4

5.6

3.4

Exposure Pre-test +Suc. +Wat. CPP test
Re-exposure

2.5

11.1

3.7

1.6

2.1

11.7

1.6

4.8

2

1.1

2.6

1

8.5

2.9

6.2

1.8

7.1

3.7

d
0.6

Exposure Pre-test +Suc. +Wat. CPP test
Re-exposure

NaTurE NEuroSciEncE

c

PC 1

PC 2

PC 3

1

–0.7 0 0.7 –0.7 0 0.7 –0.7 0 0.7

Exposure

Topological distance

Pre-test

+Suc.

0.75

+Wat.

CPP test

Re-exposure

Exposure Pre-test +Suc. +Wat. CPP test Re-exposure

PC 1

1.6

9.9

5.7

5.6

1.4

3.9

2.2

1

1

11.5

4.4

3.8

1

1

1

1

1

6.6

1.2

1

7.6

1.3

–0.5

–0.5

–0.5

2.7

2.9

PC 2

PC3 0.6 0.6

7.4 5.2

e
–0.5

PC 2 0

0.6 0.6

PC 3

0

–0.5

–0.5

1

1.4

0

5

1.1

PC 1

0

Max

Firing

rate (Hz)

0.6

Fig. 2 | Mnemonic information spans multiple network co-firing axes. a, Example firing maps across CPP task sessions (one cell per row; numbers indicate peak rate). b, Average matrix of the topological distances separating the co-firing graphs across the six CPP task sessions. c–e, PC analysis applied to matrices of topological distances unfolded multiple axes explaining across-session variance in co-firing. c, Weight vectors representing the contribution of individual sessions to the variance in topological distances along the first three PCs. d, Projection of the topological distances between co-firing motifs onto the first three PCs. Each data point represents one (color-coded) session of a given mouse day. e, Same topological distances projected on the PC1 versus PC2 (left) and PC3 (right) planes. Note the segregation of co-firing motifs along PC1 for sessions in familiar versus CPP enclosures, for the four CPP sessions along PC2 and for exposure/re-exposure sessions along PC3.

vector of distances to the adjacency matrices of the other sessions recorded that day (n = 6 task session pairwise distance vectors, together forming one 6 × 6 matrix each day; Fig. 2b and Extended Data Fig. 5a). Principal component (PC) analysis of the distance matrices revealed three axes explaining ~80% of the variance between co-firing graphs across CPP task sessions (Fig. 2c–e and Extended Data Fig. 5b–e). Along the first PC, the co-firing patterns of a given session overlapped with those of the other sessions in the same environment but not across (Fig. 2c–e), thus discriminating the familiar enclosure from the novel CPP apparatus and reporting the hippocampal remapping between these contexts (Extended Data Fig. 4a–d). Co-activity along the next two components disentangled the distinct behavioral experiences within each enclosure— namely, the four CPP sessions on the second axis and the sessions before from those after reward on the third axis, notably separat-

ing exposure and re-exposure to the familiar enclosure and, thus, reporting the topological hysteresis after CPP (Fig. 1f). These results held when considering separately the two CPP compartments during pre-test and test (Extended Data Fig. 5f,g). Across CPP task sessions, co-firing motifs, therefore, spanned different directions of the network activity space, segregating spatial contexts while discretizing events within them. Likewise, multiple axes explained hippocampal co-firing in the other tasks (Extended Data Fig. 5h–j) as a general principle to organize information in the network.
Recent findings suggest that the heterogeneity of the principal cell population, marked by the skewed (log-normal) distribution of firing rates, is central to the network operations underlying hippocampal function8–16. We, thus, identified principal cells in the top and bottom quartiles of the firing rate distribution during the exposure session (Fig. 3a) to examine the contribution of

328

Nature Neuroscience | VOL 24 | March 2021 | 326–330 | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

a 120

Low-activity cells High-activity cells

Brief Communication

b
Exposure

Low-activity cell Firing rate: 0.162 Hz, bursting index: 0.012 Exposure

High-activity cell Firing rate: 2.508 Hz, bursting index: 0.117

Count

Re-exposure Firing rate: 0.916 Hz, bursting index: 0.152 Re-exposure Firing rate: 3.188 Hz, bursting index: 0.117

0 10–3
c

10–2

10–1

100

101

Firing rate (Hz)

Topological

d

distance

0.3

0.6

1

PC1

PC2

PC3

Low–low activity motifs

Exposure Pre-test +Suc. +Wat. CPP test
Re-exposure

Variance explained

Exposure

Pre-test

Low–high

+Suc.

0

activity motifs

+Wat.

0.06

CPP test

Re-exposure

Exposure

0

Mean ∆

Pre-test

High–high activity motifs

+Suc. +Wat. CPP test

Re-exposure

Exposure Pre-test +Suc. +Wat. CPP test
Re-exposure

–0.12 Low–low Low–high High–high motifs motifs motifs

Low–low Low–high High–high motifs motifs motifs

Low–low Low–high High–high motifs motifs motifs

Fig. 3 | High- and low-activity cells contribute differentially to network co-firing axes. a, Firing rate (log-normal) distribution of principal cells during exposure. The highest and lowest quartiles formed the high- and low-activity subpopulations, respectively. b, Example spike trains of a low-activity cell and a high-activity cell during exposure and re-exposure. Two raster plots shown for each cell (60-s rows, vertical ticks representing spike times) during exposure (top) and re-exposure (bottom). For clarity, the first 5 min of each session is represented. c, Matrices of topological distances separating co-firing graphs across sessions, for low–low-, low–high- and high–high-activity cell pairs. d, Cumming estimation plots showing the contribution of low–low-, low–high- and high–high-activity cell pairs to co-firing variance along the first three axes of the CPP network. Top: each data point represents the variance explained by a given co-firing motif along one axis for 1 d. Bottom: for each axis, the co-firing motif with the strongest contribution (color-coded dashed line) is compared with the other two motifs’ contribution. Black dot, mean difference; black ticks, 95% confidence interval; filled curve: sampling error distribution.

these two subpopulations to co-firing graphs. High- and low-rate principal cells were biased toward deep and superficial pyramidal sublayers, respectively (Extended Data Fig. 6)8,13,15. We noted that low-activity cells, but not high-activity cells, discharged more bursts of spikes (spike packets with inter-spike intervals within 6 ms) during re-exposure compared to exposure (Fig. 3b and Extended Data Fig. 7a,b), sustaining an increased firing rate 1 h after CPP (Extended Data Fig. 7c). These enduring activity changes were not observed in the other tasks (Extended Data Fig. 7d–i). Moreover, low-activity cells with higher bursting during re-exposure showed increased spatial coherence and information content (Extended Data Fig. 8). Remarkably, these cells initially had the lowest place field coherence during exposure and became spatially informative after CPP learning (Extended Data Fig. 9). In addition, low-activity cells with the most spatially tuned activity during exposure also showed increased spatial information during re-exposure, without altered burst spiking (Extended Data Fig. 9). These results suggested that the crosstalk between the new CPP memory and the prior familiar representation involved the heightened network contribution of low-activity cells after their recruitment during CPP learning.

Indeed, the low-activity subpopulation, but not the high-activity subpopulation, exhibited sustained topological changes throughout CPP sessions (Extended Data Fig. 10a), explaining whole-network hysteresis during re-exposure (Fig. 1f). Moreover, reward-related firing modulation of low-activity cells from pre-test to sucrose conditioning in the CPP enclosure predicted changes in co-firing from exposure to re-exposure in the familiar enclosure (Extended Data Fig. 10b,c), constituting another instance of the effect of reward on hippocampal activity13,17.
We finally evaluated the contribution of high- and low-activity subpopulations to network co-firing motifs, leveraging the Riemannian log-Euclidean framework (Fig. 2b–e). Co-firing solely involving high-activity cells segregated the two task enclosures at the onset of pre-test (Fig. 3c and Extended Data Fig. 10d). Co-activity motifs including low-activity cells did not distinguish familiar exposure and novel CPP pre-test (Fig. 3c and Extended Data Fig. 10d). Rather, this subpopulation integrated co-firing patterns as mice experienced each task event, staying engaged thereafter during re-exposure where their contribution to network motifs reached that of high-activity cells. Accordingly, in the CPP task, the

Nature Neuroscience | VOL 24 | March 2021 | 326–330 | www.nature.com/natureneuroscience

329

Brief Communication

NaTurE NEuroSciEncE

high- and low-activity cells contributed more to the first and third co-firing network axis, respectively, whereas their combination explained more the second axis (Fig. 3d). Moreover, the topological changes affecting the co-firing structure of the network during active exploration were associated with changes in SWR co-firing of low-activity cells during awake rest (Extended Data Fig. 10e,f), in line with recent work showing that these two subpopulations exhibit distinct SWR response12,18.
In conclusion, by exploring the hippocampal network activity space from a graph theoretical perspective, we show that new associative memories (place–reward) restructure the neural patterns representing prior memory for an unrelated environment. During this transformation of the hippocampal co-firing structure, high-activity cells organize motifs that rapidly discriminate spatial contexts, robust to perturbation by subsequent experience. This contribution might instantiate a spatio-contextual backbone for memory schemas19,20. Low-activity cells integrate co-activity motifs on demand, throughout behavioral events. Their heightened engagement continues after new place–reward learning and across contexts, affecting the network representation of an otherwise familiar environment. This effect could involve low-rate principal cell plasticity12, leveraged by high computational load or neuro-modulatory processes, when novel contextual information and reward experience are related in memory. The newly acquired topology of the hippocampal firing output, shaped by past inputs, might not be permanent, perhaps slowly returning to a baseline configuration as memories consolidate to other cortical circuits. The observed hysteresis could represent a network response protecting existing memories from catastrophic interference by adjusting the co-firing structure of learned associations or forming redundant ones. This could also reflect retroactive encoding of recent experience, juxtaposing the current spatial reference frame with those encountered before. Together, these findings support the view of a division in computational labor within the log-normally distributed principal cell population for the hippocampal discretization of memories of space and events, allowing adaptive insertion and interaction of new information within a larger network of prior knowledge.
Online content Any methods, additional references, Nature Research reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests; and statements of data and code availability are available at https://doi.org/10.1038/ s41593-021-00804-w.
Received: 18 March 2020; Accepted: 19 January 2021; Published online: 18 February 2021

References
1. Andersen, P., Morris, R. G. M., Amaral, D., Bliss, T. & O’Keefe, J. The Hippocampus Book (Oxford University Press, 2006).
2. Moser, E. I., Moser, M.-B. & McNaughton, B. L. Spatial representation in the hippocampal formation: a history. Nat. Neurosci. 20, 1448–1464 (2017).
3. Buzsáki, G. & Llinás, R. Space and time in the brain. Science 358, 482–485 (2017).
4. Kubie, J. L., Levy, E. R. J. & Fenton, A. A. Is hippocampal remapping the physiological basis for context? Hippocampus 30, 851–864 (2020).
5. O’Neill, J., Senior, T. J., Allen, K., Huxter, J. R. & Csicsvari, J. Reactivation of experience-dependent cell assembly patterns in the hippocampus. Nat. Neurosci. 11, 209–215 (2008).
6. Bassett, D. S. & Sporns, O. Network neuroscience. Nat. Neurosci. 20, 353–364 (2017).
7. Humphries, M. D. Dynamical networks: finding, measuring, and tracking neural population activity using network science. Netw. Neurosci. 1, 324–338 (2017).
8. Mizuseki, K., Diba, K., Pastalkova, E. & Buzsáki, G. Hippocampal CA1 pyramidal cells form functionally distinct sublayers. Nat. Neurosci. 14, 1174–1181 (2011).
9. Buzsáki, G. & Mizuseki, K. The log-dynamic brain: how skewed distributions affect network operations. Nat. Rev. Neurosci. 15, 264–278 (2014).
10. Rich, P. D., Liaw, H.-P. & Lee, A. K. Large environments reveal the statistical structure governing hippocampal representations. Science 345, 814–817 (2014).
11. Soltesz, I. & Losonczy, A. CA1 pyramidal cell diversity enabling parallel information processing in the hippocampus. Nat. Neurosci. 21, 484–493 (2018).
12. Grosmark, A. D. & Buzsáki, G. Diversity in neural firing dynamics supports both rigid and learned hippocampal sequences. Science 351, 1440–1443 (2016).
13. Danielson, N. B. et al. Sublayer-specific coding dynamics during spatial navigation and learning in hippocampal area CA1. Neuron 91, 652–665 (2016).
14. Cembrowski, M. S. & Spruston, N. Heterogeneity within classical cell types is the rule: lessons from hippocampal pyramidal neurons. Nat. Rev. Neurosci. 20, 193–204 (2019).
15. Oliva, A., Fernández-Ruiz, A., Buzsáki, G. & Berényi, A. Spatial coding and physiological properties of hippocampal neurons in the cornu Ammonis subregions. Hippocampus 26, 1593–1607 (2016).
16. Navas-Olive, A. et al. Multimodal determinants of phase-locked dynamics across deep-superficial hippocampal sublayers during theta oscillations. Nat. Commun. 11, 2217 (2020).
17. Gauthier, J. L. & Tank, D. W. A dedicated population for reward coding in the hippocampus. Neuron 99, 179–193.e7 (2018).
18. Valero, M. et al. Determinants of different deep and superficial CA1 pyramidal cell dynamics during sharp-wave ripples. Nat. Neurosci. 18, 1281–1290 (2015).
19. McKenzie, S. et al. Hippocampal representation of related and opposing memories develop within distinct, hierarchically organized neural schemas. Neuron 83, 202–215 (2014).
20. Tse, D. et al. Schemas and memory consolidation. Science 316, 76–82 (2007).
Publisher’s note Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.
© The Author(s), under exclusive licence to Springer Nature America, Inc. 2021

330

Nature Neuroscience | VOL 24 | March 2021 | 326–330 | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

Brief Communication

Methods
Animals. These experiments used adult male C57BL/6J mice (Charles River Laboratories) or transgenic heterozygous CamKIIa-Cre mice (Jackson Laboratory, CamKIIa-Cre B6.Cg-Tg(Camk2a-cre)T29-1Stl/J, stock no. 005359, RRID: IMSR_ JAX:005359, maintained on a C57BL/6J background). Mice were housed with their littermates until the surgical procedure with free access to food and water in a room with a 12-h light/dark cycle, 19–23 °C ambient temperature and 40–70% humidity. All mice were held in individually ventilated cages with wooden chew sticks and nestlets. Mice were 4–7 months old at the time of testing. Experimental procedures were performed on mice in accordance with the Animals (Scientific Procedures) Act, 1986 (United Kingdom), with final ethical review by the Animals in Science Regulation Unit of the UK Home Office.
Surgical procedure. Mice were implanted with a microdrive during a surgical procedure performed under deep anaesthesia using isoflurane (0.5–2%) and oxygen (2 L min−1), with analgesia (0.1 mg kg−1 vetergesic) provided before and after surgery. Microdrives contained 10–12 tetrodes, targeting the stratum pyramidale of the dCA1 hippocampus21. Tetrodes were constructed by twisting together four insulated tungsten wires (12-µm diameter, California Fine Wire) and heating them to fuse them into a single bundle. Each tetrode was attached to a M1.0 screw to enable their independent movement. The drive was implanted under stereotaxic control in reference to bregma21. Tetrodes were initially implanted above the CA1 pyramidal layer, and their exposed parts were covered with paraffin wax. The drive was then secured to the skull using dental cement, and stainless steel anchor screws were inserted into the skull. Two of the anchor screws, both above the cerebellum, were attached to a 50-µm tungsten wire (California Fine Wire) and served as ground. Tetrode placement was confirmed by the electrophysiological profile of the local field potentials (LFPs) in the hippocampal ripple frequency band and anatomical electrode tracks21,22. In one mouse, a single-shank silicon probe (NeuroNexus, model A1x32-5 mm-25177-H32_21 mm) was implanted following the same surgical procedure to span the somato-dendritic axis of dCA1 principal cells and establish the laminar profile of the SWRs detected in the LFPs. These silicon probe recordings allowed estimating the position (depth) of individual tetrode-recorded principal cell soma (Extended Data Fig. 6).
Recording procedure. After at least 1 week after operative recovery, mice were handled for 3–4 d and then daily familiarized to the experimental paradigm, including connection to the electrophysiological recording system and exploration of a circular-walled open-field enclosure (42-cm diameter; the familiar enclosure). Mice were food restricted (to ~90% body weight), and the various experimental conditions were randomly allocated across mice and recording days.
The 1-day CPP task included four sessions: pre-test, place conditioning to sucrose (+Suc.), place conditioning to water (+Wat.) and test23. The enclosure consisted of two square-walled (46 cm × 46 cm × 38 cm) compartments with distinct inside building block configurations on each day. A bridge (8-cm length and 7-cm width) connected the two compartments during pre-test and CPP test. A linear locomotion assistant (Imetronic) held the recording cable while sensing its movement using infrared light beam detectors, allowing the connected animal to move freely within and across compartments. During pre-test, mice explored the entire CPP enclosure for 15 min, and their baseline (spontaneous) preference for one of the two compartments was determined. Next, the bridge was removed for the conditioning sessions, and mice explored their non-preferred compartment containing drops of 20% sucrose diluted in water (2 × 10-min sessions and 10 × 10-μl drops per session). Next, mice explored their preferred compartment containing drops of water (2 × 10-min sessions and 10 × 10-μl drops per session). One hour later, CPP memory was assessed by allowing the mice to explore the entire apparatus for 15 min (CPP test). We calculated a place preference score for each mouse during both pre-test and test sessions as the difference between the time spent in the compartment paired with sucrose minus that paired with water during conditioning over their sum. On the morning of each recording day, the LFP signals obtained from each tetrode were used to guide its optimal positioning within the dCA1 pyramidal layer in search of multi-unit spiking activity21. Tetrodes were left in position for ~1.5–2 h before recordings started. On each day, ensemble recordings were performed continuously while mice explored the familiar circular-walled enclosure before and after (‘exposure’ and ‘re-exposure’, 15 min each) the CPP task. Mice were subjected to a novel CPP enclosure on each recording day (that is, novel spatial configurations and wall cue cards).
Three other behavioral tasks had a six-session layout similar to that of the CPP task, to evaluate whether the topological deviations observed during CPP reflected a general network response for integrating new information. In these three tasks, each day contained six sessions that matched the timeline of the CPP task. Mice explored the familiar enclosure before (exposure) and 1 h after (re-exposure): 1) four sessions of spatial exploration in a novel enclosure without reward (the ‘Novel context only’ task; Extended Data Fig. 2a); 2) four sessions testing spontaneous preference for one of two novel enclosures, without reward (the ‘Spontaneous place preference’ task; Extended Data Fig. 2c); or 3) four sessions of spatial exploration in a second familiar enclosure with sucrose reward and water provided in the second and third session, respectively (the ‘Familiar context with reward’ condition;

Extended Data Fig. 2f), as in the CPP task (Fig. 1a). A fifth task further allowed testing whether network topological deviations occurred during repeated exploration of a familiar enclosure (the ‘Familiar context only’ task; four exploration sessions in the same familiar enclosure on each day; Extended Data Fig. 2h).
On each recording day, mice were returned to their home cage between task sessions, having access to water and food while the experimenter prepared the open-field arena for the next session. Data collection could not be performed blinded to the conditions of the experiments because the experimenter had to be aware as to which condition they had to expose each mouse on a given day (which behavioral task) and on a given session (which open-field arena). At the end of each day, tetrodes were raised to avoid possible mechanical damage overnight.
Multi-channel data acquisition and position tracking. The extracellular signals from the electrodes were amplified, multiplexed and digitized using a single integrated circuit located on the head of the animal (RHD2164, Intan Technologies; gain ×1000). The amplified and filtered (0.09 Hz–7.60 kHz) electrophysiological signals were digitized at 20 kHz and saved to disk along with the synchronization signals from the position tracking. To track the location of the animal, three LED clusters were attached to the electrode casing and captured at 25 frames per s by an overhead color camera.
Spike detection and unit isolation. For the offline detection of spikes, the recorded signals were first band-pass filtered (800 Hz–5 kHz). Spikes were then detected based on the power (root mean square) of the filtered signal calculated in 0.2-ms sliding windows. Detected spikes of the individual electrodes were combined per tetrode. To isolate spikes belonging to the same neuron, spike waveforms were first up-sampled to 40 kHz and aligned to their maximal trough24. PC analysis was applied to these waveforms ±0.5 ms from the trough to extract the first three or four PCs per channel, such that each individual spike was represented by 12 waveform parameters. An automatic clustering program (KlustaKwik, http:// klusta-team.github.io) was run on this PC space, and the resulting clusters were manually recombined and further isolated based on cloud shape in the PC space, cross-channel spike waveforms, auto-correlation histograms and cross-correlation histograms25,26. All sessions recorded on the same day were concatenated and clustered together. Each cluster used for further analysis showed, throughout the entire recording day, stable cross-channel spike waveforms, a clear refractory period in its auto-correlation histogram, well-defined cluster boundaries and an absence of refractory period in its cross-correlation histograms with the other clusters. Hippocampal principal cells were identified by the shape of their auto-correlation histogram, their firing rate and their spike waveform24. We further used an automated clustering pipeline using KiloSort (https://github.com/ cortex-lab/KiloSort)27 via the SpikeForest sorting framework (https://github.com/ flatironinstitute/spikeforest)28. To apply KiloSort to data acquired using tetrodes, the algorithm restricted templates to channels within a given tetrode bundle while masking all other recording channels. The resulting clusters were manually curated to check all clusters and remove spurious units using metrics derived from the waveforms and spike times and then verified by the operator. This procedure was cross-validated using several datasets and verified against manual curation, by computing confusion matrices to validate that clusters obtained automatically were also obtained with the previous method.
In total, this study included n = 3,483 principal cells from 63 recording days: n = 1,083 principal cells in the ‘CPP’ task (63.7 ± 33.2 principal cells per day, 17 CPP six-session days from seven mice—five CamKIIa-Cre and two C57BL/6J— yielding 102 graphs and 260,058 co-firing pairs); n = 585 principal cells in the ‘Novel context only’ task (45.0 ± 13.7 principal cells per day, 13 ‘Novel context only’ six-session days from five mice—three CamKIIa-Cre and two C57BL/6J—yielding 78 graphs and 28,192 co-firing pairs); n = 640 principal cells in the ‘Spontaneous place preference’ task (49.2 ± 17.5 principal cells per day, 13 ‘Spontaneous place preference’ six-session days from six mice—three CamKIIa-Cre and three C57BL/6 J—yielding 78 graphs and 34,838 co-firing pairs); n = 517 principal cells in the ‘Familiar context with reward’ task (57.4 ± 12.2 principal cells per day, nine ‘Familiar context with reward’ six-session days from three mice—two CamKIIa-Cre and one C57BL/6J—yielding 54 graphs and 30,512 co-firing pairs); and n = 658 principal cells in the ‘Familiar context only’ task (59.3 ± 15.8 principal cells per day, 11 ‘Familiar context only’ four-session days from three mice—two CamKIIa-Cre and one C57BL/6J—yielding 44 graphs and 40,744 co-firing pairs).
SWRs. LFPs of each pyramidal CA1 channel (for tetrode recordings) or recording site (for linear silicon probe recordings) were subtracted by the mean across all channels and sites (common average reference). These re-referenced signals were then filtered for the ripple band (110–250 Hz; 4th-order Butterworth filter), and their envelopes (instantaneous amplitudes) were computed by means of the Hilbert transform. The peaks (local maxima) of the ripple band envelope signals above a threshold (five times the median of the envelope values of that channel) were regarded as candidate events. Furthermore, the onset and offset of each event were determined as the time points at which the ripple envelope decayed below half of the detection threshold. Candidate events passing the following criteria were determined as SWR events: 1) ripple band power in the event channel was at least

Nature Neuroscience | www.nature.com/natureneuroscience

Brief Communication

NaTurE NEuroSciEncE

two times the ripple band power in the common average reference (to eliminate common high-frequency noise); 2) an event had at least four ripple cycles (to eliminate events that were too brief); and 3) ripple band power was at least two times higher than the supra-ripple band defined as 200–500 Hz (to eliminate high-frequency noise, not spectrally compact at the ripple band, such as spike leakage artifacts). We classified tetrodes as being in the deep or superficial sublayer of the CA1 pyramidal layer based on the mean peak amplitude of detected SWRs (Extended Data Fig. 6). Positive values indicated that the tetrode was in the deep sublayer (that is, closest to the stratum oriens), whereas negative values indicated that the tetrode was in the superficial sublayer (that is, closest to the stratum radiatum)8,15,29. SWRs were also used as time bins to calculate SWR firing response of low- and high-activity cells (Extended Data Fig. 10e,f).

Weighted graphs of neuronal co-firing. We constructed weighted graphs that

represent the spike relationships among dCA1 principal cells recorded in a given

task session, calculating for that session the set of pairwise Pearson correlation

coefficients between all pairs of spike trains. These co-firing graphs were computed

using time bins during active exploratory behavior (with speed >2 cm s−1),

discarding periods of immobility and further excluding SWRs in each task session.

The recorded neurons (and their co-firing associations) are, therefore, the nodes

(and their edges) in the co-firing graph of each task event. We described each

graph by its adjacency matrix, A, as an N × N square matrix:

0

1

w00    w0N

A ¼ B@ ... . . . ... CA

wN0    wNN

where N is the number of nodes in the graph, and each element, wij, is a continuous weight value that defines the edge (that is, the co-firing coefficient) between
two nodes i and j. To compute each co-firing association value, we used a
bin-less approach by convolving the spike trains of i and j with a Gaussian kernel (s.d. = 40 ms) and then calculating their correlation coefficient r (thus, −1 ≤ r ≤ 1). As a result, A is symmetric, wij = wji, and the graph is undirected.

Clustering coefficient. We computed a clustering coefficient to characterize the

local synchronization of network activity by quantifying the number of three-node

motifs. In each graph, for any neuron i, we obtained its clustering coefficient Ci using the formula proposed by Onnela et al. to quantify the strength of each triad30–32:

Ci

¼

P
jq

� w^ ij

w^ iq

w^ jq1=3

kiðki � 1Þ

where j and q are neighbors of neuron i; all edge weights are normalized by the maximum edge weight in the network w^ ¼ w=maxðwÞ; and ki is the degree of neuron i, which, in these weighted graphI s with no self-connection, is equal to the number of neurons minus one. Note that this formula accounts for negative edges, yielding a negative value when there is an odd number due to the negative edges in the triad; it is positive otherwise.

Geodesic path length. We measured the geodesic (that is, shortest) path length
to estimate the coordination efficacy between the activity of any two nodes in
the graph. In a binary graph, this would represent the smallest number of edges
connecting two nodes. Here, we embedded each weighted graph in a lattice and defined the length between two nodes i and j as lij ¼ 1=wij, discarding all negative edges. We then identified the shortest path lengthI between any two nodes in the graph using the Floyd–Warshall algorithm33–35.

Single-neuron cumulative co-firing strength. We defined the single-neuron cumulative co-firing strength as the total pairwise activity correlation strength of a given node in a weighted graph. As a reference, the strength in a weighted graph can be compared to the degree in a binary graph, which accounts for the number of the node’s neighbors. Here, the strength Si of a node i is the sum of all the weights wij of the edges projected from that node:
XN Si ¼ wij
j¼0

where N is the number of neurons j that node i projects to.

Spatial rate map analyses. We divided the horizontal plane of the recording enclosures into spatial bins of approximately 2 × 2 cm to generate the spike count map (number of spikes fired in each bin) for each neuron and the occupancy map (time spent by the animal in each spatial bin) in each task session. All maps were then smoothed by convolution with a two-dimensional (2D) Gaussian kernel having an s.d. equal to two bin widths. Finally, spatial rate maps were generated by normalizing the smoothed spike count maps by the smoothed occupancy map.
The single-neuron map similarity was calculated by the 2D Pearson correlation coefficient between the place maps of a given neuron across two task sessions.

Here, this task session pairwise measure compares, for each neuron, the spatial relationship between its place map in the exposure session and that computed for another task session. For the pre-test and test sessions, two place maps were extracted (one per arena), and the single-neuron map similarity was obtained by taking the maximum similarity value between either of the two CPP sessions’ maps and that of the exposure session.
The population map similarity5,36,37 compares the spatial relationships of the set of place maps computed for one task session with those from another task session. Here, this task session pairwise measure represents the extent to which sets of cells that fired in similar regions of space (that is, overlapping place fields) during the exposure session still fire together in similar regions of space later during another task session. For this measure, we used cells with a spatial coherence value (see below) above 0.2 during the exposure session. The population map similarity was calculated by first computing the place field similarity (PFS) value for each cell pair during the exposure session as the Pearson correlation coefficient from the direct bin-wise comparisons between the spatial rate maps of the two cells, limited to valid bins (occupancy greater than zero). This procedure yields a vector storing the PFS values for all cell pairs during the exposure session. We repeated this procedure to obtain the PFS vectors of the other task sessions. Finally, the population map similarity between two task sessions was calculated as the Pearson correlation coefficient between the PFS vector of the exposure session versus the PFS vector of the chosen comparison session.

Spatial coherence. To measure the spatial coherence (that is, the similarity of a cell’s firing rate over spatial bins), we computed a boxcar-averaged version of its unsmoothed spatial rate map, with each bin replaced by the arithmetic mean of itself and its eight adjacent neighbors. The smoothed spatial rate map was then correlated to its unsmoothed version to yield a Pearson correlation value38.

Spatial mutual information. To estimate the amount of spatial information

conveyed by the spike train of a given cell, we used the mutual information

measure I(R;S):

*

+

IðR; SÞ ¼

X
r2R

pðrjsÞlog2

pðrjsÞ pðrÞ

S

where S is the discrete random variable formed by the set of the animal’s spatial
locations s, and R is the discrete random variable formed by the set of possible spike count responses r39–41. This was corrected for estimation bias by subtracting an analytical estimate of the bias42.

Across-graph topological distance analyses. Co-firing graphs have symmetric and positive semi-definite adjacency matrices because their elements are computed using the Pearson correlation coefficient between pairs of spike trains. Thus, their topologies lie on a Riemannian manifold43, and the distance between them is most accurately measured by the geodesic distance between them44. Accordingly, we employed the log-Euclidean metric45 to compute the topological distance between constellations of co-firing patterns for pairs of task session graphs. From a Euclidean norm on symmetric matrices ||·||, the distance DLE between two matrices is given by:
DLEðA1; A2Þ ¼ klogðA1Þ � logðA2Þk
where A1 and A2 are the two adjacency matrices to be compared, and log(·) iesxtphðeAmÞ ¼atrPix l1ko¼g0aArikt=hkm! , the inverse of the matrix exponential defined as I This procedure projects the adjacency matrices to a flat (zero curvature) Riemannian space, allowing applying Euclidean computations. This way, we obtained for each task session s (from exposure to re-exposure) a vector of six topological distances Ds separating the co-firing graph of that session to the co-firing graph of each of the other five task sessions as well as to itself (by adding one s.d. of white noise to avoid exact zero results). We normalized each of these vectors by their maximum distance value, to compare them across days. We, thus, obtained a 6 × 6 matrix of the topological distances among the co-firing graphs of the six task sessions for each recording day.
PC analysis was used as a dimensionality reduction method to visualize the topological distances separating all co-firing graphs in the activity space of the hippocampal network. To do so, we stacked all topological distance vectors in a 6 × N matrix, where N is the total number of co-firing graphs (N = n_d × n_s, one graph per task session, n_s, per recording day, n_d). We next used PC analysis on the recordings with more than 40 principal cells to obtain the set of PCs that indicate trajectories in the network activity space along which co-firing graphs evolved from exposure to re-exposure task sessions. We then projected the first PCs that explained 80% of the variance in co-firing patterns onto the topological distances separating the co-firing graphs of all recordings from a given task. Independent component analysis and multi-dimensional scaling were also used as additional methods for such a visualization.
Of note, there was a possibility that using the Pearson correlation to evaluate distances between each pair of co-firing matrices could alter the eigenvalues and

Nature Neuroscience | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

Brief Communication

the positive semi-definiteness of the co-firing matrices. Because eigenvalues are the basis for computing geodesic distances, the Pearson correlation coefficient could distort the similarity evaluation between co-firing matrices44. However, we additionally applied the Pearson correlation coefficient to measure the relationships between co-firing matrices across CPP task sessions: the first three PCs extracted this way corresponded to those revealed by the Riemannian log-Euclidean distance metric (Extended Data Fig. 5d,e), notably showing that the co-firing network axes reported in this study are not mere outputs of a specific analysis method.

Bursting index. For the spike train of each neuron, we defined spike bursts as transient packets of spikes with inter-spike intervals of less than 6 ms46,47. We used
the inter-spike interval t versus inter-spike interval t + 1 plot to identify the first, mid and last spikes of each burst candidate. The bursting index was then defined
by the ratio of bursting spikes out of all the spikes fired by the neuron.

High- and low-activity cells contribution to network co-firing patterns. For each

task session s, we quantified the contributions CGs of the high- and low-activity

sub-networks G to network-level co-firing patteIrns by computing the Euclidean

distance RsG between the six-dimensional topological distance vector representing the entireInetwork Ds and those representing the two sub-networks DsG (see

section above):

I

RsG ¼ EuclideanðDs; DsGÞ; CGs ¼ 1 � RsG

Data and statistical analyses. Data were analyzed in Python 3.6 and using the packages DABEST v0.3.0 (ref. 48), scikit-learn v0.23.2 (ref. 49), NetworkX v2.4 (ref. 50), pyentropy v0.5.0 (ref. 51), Numpy v1.18.1, Scipy v1.4.1, Matplotlib v3.1.2, Pandas v0.25.3 and Seaborn v0.11.0. All statistical tests related to a symmetric distribution were performed two sided using Gardner–Altman plots (to compare two groups) and Cumming plots (for more groups) from the DABEST framework48. These DABEST plots allow visualizing the effect size by plotting the data as the mean or median difference between one of the groups (the left-most group of each plot, used as group reference) and the other groups (to the right, along the x axis of each plot). For each estimation plot: 1) the upper panel shows the distribution of raw data points for the entire dataset, superimposed on bar plots reporting group mean ± s.e.m., unless stated otherwise; and 2) the lower panel displays the difference between a given group and the (left-most) group reference, computed from 5,000 bootstrapped re-samples and with difference-axis origin aligned to the mean or the median of the group reference distribution. For each estimation plot: black dot, mean (for normal distributions) or median (for skewed distributions) as indicated; black ticks, 95% or 99% confidence interval as indicated; and filled curve: bootstrapped sampling error distribution. Data distributions were assumed to be normal, but this was not formally tested. We also used the t-test to compare two conditions; the Wald test for assessing the significance of regression lines; and the Kolmogorov–Smirnov test for comparing probability distributions. No statistical methods were used to pre-determine sample sizes, but our sample sizes are similar to those reported in previous publications (for example, refs. ). 5,8,10,12,13,15–19 Neural and behavioral data analyses were conducted in an identical way regardless of the identity of the experimental condition from which the data were collected, with the investigator blinded to group allocation during data collection and/or analysis. See also the corresponding Life Sciences Reporting Summary.
Reporting Summary. Further information on research design is available in the Nature Research Reporting Summary linked to this article.
Data availability
The data that support the findings of this study are available from the corresponding author upon reasonable request.
Code availability
The software used for data acquisition and analysis are available using the web links mentioned in the Methods.
References
21. van de Ven, G. M., Trouche, S., McNamara, C. G., Allen, K. & Dupret, D. Hippocampal offline reactivation consolidates recently formed cell assembly patterns during sharp wave-ripples. Neuron 92, 968–974 (2016).
22. Csicsvari, J., Hirase, H., Czurkó, A., Mamiya, A. & Buzsáki, G. Oscillatory coupling of hippocampal pyramidal cells and interneurons in the behaving rat. J. Neurosci. 19, 274–287 (1999).
23. Trouche, S. et al. A hippocampus-accumbens tripartite neuronal motif guides appetitive memory in space. Cell 176, 1393–1406.e16 (2019).
24. Csicsvari, J., Hirase, H., Czurko, A. & Buzsáki, G. Reliability and state dependence of pyramidal cell–interneuron synapses in the hippocampus. Neuron 21, 179–189 (1998).

25. Harris, K. D., Henze, D. A., Csicsvari, J., Hirase, H. & Buzsáki, G. Accuracy of tetrode spike separation as determined by simultaneous intracellular and extracellular measurements. J. Neurophysiol. 84, 401–414 (2000).
26. Kadir, S. N., Goodman, D. F. M. & Harris, K. D. High-dimensional cluster analysis with the masked EM algorithm. Neural Comput. 26, 2379–2394 (2014).
27. Pachitariu, M., Steinmetz, N. A., Kadir, S. N., Carandini, M. & Harris, K. D. Fast and accurate spike sorting of high-channel count probes with KiloSort. Adv. Neural Inform. Process. Syst. 30, 4455–4463 (2016).
28. Magland, J. F. et al. SpikeForest: reproducible web-facing ground-truth validation of automated neural spike sorters. eLife 9, e55167 (2020).
29. Csicsvari, J., Hirase, H., Czurko, A., Mamiya, A. & Buzsáki, G. Fast network oscillations in the hippocampal CA1 region of the behaving rat. J. Neurosci. 19, 1–4 (1999).
30. Onnela, J.-P., Saramäki, J., Kertész, J. & Kaski, K. Intensity and coherence of motifs in weighted complex networks. Phys. Rev. E Stat. Nonlin. Soft Matter Phys. 71, 065103 (2005).
31. Costantini, G. & Perugini, M. Generalization of clustering coefficients to signed correlation networks. PLoS ONE 9, e88669 (2014).
32. Saramäki, J., Kivelä, M., Onnela, J.-P., Kaski, K. & Kertész, J. Generalizations of the clustering coefficient to weighted complex networks. Phys. Rev. E 75, 027105 (2007).
33. Floyd, R. W. Algorithm 97: shortest path. Commun. ACM 5, 345 (1962). 34. Roy, B. Transitivité et connexité. C. R. Acad. Sci. Paris 249, 216–218 (1959). 35. Warshall, S. A theorem on Boolean matrices. J. ACM 9, 11–12 (1962). 36. Dupret, D., O’Neill, J., Pleydell-Bouverie, B. & Csicsvari, J. The reorganization
and reactivation of hippocampal maps predict spatial memory performance. Nat. Neurosci. 13, 995–1002 (2010). 37. McNamara, C. G., Tejero-Cantero, Á., Trouche, S., Campo-Urriza, N. & Dupret, D. Dopaminergic neurons promote hippocampal reactivation and spatial memory persistence. Nat. Neurosci. 17, 1658–1660 (2014). 38. Zhang, S., Schönfeld, F., Wiskott, L. & Manahan-Vaughan, D. Spatial representations of place cells in darkness are supported by path integration and border information. Front Behav. Neurosci. 8, 222 (2014). 39. Butts, D. A. How much information is associated with a particular stimulus? Network 14, 177–187 (2003). 40. Cover, T. M. & Thomas, J. A. Elements of Information Theory (Wiley, 1991). 41. Shannon, C. & Weaver, W. The Mathematical Theory of Communication (Univ. of Illinois, 1949). 42. Panzeri, S. & Treves, A. Analytical estimates of limited sampling biases in different information measures. Netw. Comput. Neural Syst. 7, 87–107 (1996). 43. Moakher, M. A differential geometric approach to the geometric mean of symmetric positive–definite matrices. SIAM J. Matrix Anal. Appl 26, 735–747 (2005). 44. Venkatesh, M., Jaja, J. & Pessoa, L. Comparing functional connectivity matrices: a geometry-aware approach applied to participant identification. Neuroimage 207, 116398 (2020). 45. Arsigny, V., Fillard, P., Pennec, X. & Ayache, N. Log-Euclidean metrics for fast and simple calculus on diffusion tensors. Magn. Reson. Med. 56, 411–421 (2006). 46. Harris, K. D., Hirase, H., Leinekugel, X., Henze, D. A. & Buzsáki, G. Temporal interaction between single spikes and complex spike bursts in hippocampal pyramidal cells. Neuron 32, 141–149 (2001). 47. Ranck, J. B. Studies on single neurons in dorsal hippocampal formation and septum in unrestrained rats. I. Behavioral correlates and firing repertoires. Exp. Neurol. 41, 461–531 (1973). 48. Ho, J., Tumkaya, T., Aryal, S., Choi, H. & Claridge-Chang, A. Moving beyond P values: data analysis with estimation graphics. Nat. Methods 16, 565–566 (2019). 49. Pedregosa, F. et al. Scikit-learn: machine learning in Python. J. Mach. Learn. Res. 12, 2825–2830 (2011). 50. Hagberg, A. A., Schult, D. A. & Swart, P. J. Exploring network structure, dynamics, and Function using NetworkX. in Proc. 7th Python in Science Conference 11–15 (ScyPi, 2008). 51. Ince, R. A. A., Petersen, R. S., Swan, D. C. & Panzeri, S. Python for information theoretic analysis of neural data. Front. Neuroinform. https://doi. org/10.3389/neuro.11.004.2009 (2009).
Acknowledgements
We would like to thank J. Csicsvari and R. Lambiotte for commenting on a previous version of the manuscript; J. Janson for technical assistance; and H. C. Barron and all members of the Dupret and Schultz labs for discussions and feedback during the course of this project. This work was supported by the Engineering and Physical Sciences Research Council UK Centre for Doctoral Training in Neurotechnology (EP/ L016737/1 to S.R.S.), the Biotechnology and Biological Sciences Research Council UK (award BB/N002547/1 to D.D.) and the Medical Research Council UK (Programmes MC_UU_12024/3 and MC_UU_00003/4 to D.D.).

Nature Neuroscience | www.nature.com/natureneuroscience

Brief Communication

NaTurE NEuroSciEncE

Author contributions
All authors contributed to the preparation of the manuscript. G.P.G., S.R.S. and D.D. designed the study, developed the methodology and analyzed the data. S.B.M., L.L., V.L.d-.S., M.E. S.T. and D.D. acquired the data and helped with data analysis. S.R.S. and D.D. acquired funding.
Competing interests
The authors declare no competing interests.

Additional information
Extended data is available for this paper at https://doi.org/10.1038/s41593-021-00804-w.
Supplementary information The online version contains supplementary material available at https://doi.org/10.1038/s41593-021-00804-w.
Correspondence and requests for materials should be addressed to S.R.S. or D.D.
Peer review information Nature Neuroscience thanks the anonymous reviewers for their contribution to the peer review of this work.
Reprints and permissions information is available at www.nature.com/reprints.

Nature Neuroscience | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

Brief Communication

Extended Data Fig. 1 | Behavioural performance and hippocampal co-firing graphs in the CPP task. a, Additional example trajectories for four mice. Each day (one day per row), mice explored the same (circular-walled) familiar enclosure before (exposure) and after (re-exposure) a 1-day 4-session CPP task (Fig. 1a). The CPP apparatus was formed by two novel compartments on each day. Numbers indicate place preference scores for pre-test and CPP test sessions, as the time in sucrose-paired compartment (+Suc.) minus that in water-paired compartment (+Wat.) divided by the sum. b, Place preference scores. A negative score indicates that mice spent less time in the compartment paired with sucrose during conditioning. Note that during CPP test, mice successfully changed their preference for the compartment recently paired with sucrose, as indicated by the positive score. Scores are presented using a Gardner-Altman estimation plot to visualise the effect size. The left panel shows the distribution of raw data points for the pre-test and test sessions. The right panel displays the difference between CPP test and pre-test, computed from 5,000 bootstrapped resamples and with difference-axis origin aligned to the mean of the pre-test session distribution. Black-dot, mean difference; black-ticks, 99% confidence interval; gray-filled-curve: sampling-error distribution. c, The adjacency matrices (top row) of the pairwise correlation coefficients measuring principal cells’ co-firing for days shown in (a), with the corresponding co-firing graphs (bottom row). Each node represents one principal cell. Each edge represents the co-firing association of one cell pair, color-coded according to their correlation’s sign and width proportional to the edge’s absolute value.
Nature Neuroscience | www.nature.com/natureneuroscience

Brief Communication

NaTurE NEuroSciEncE

Extended Data Fig. 2 | See next page for caption.

Nature Neuroscience | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

Brief Communication

Extended Data Fig. 2 | Graph topology during exploration of a novel enclosure, spontaneous novel place preference and exploration of a familiar enclosure with or without reward. a,b, “Novel context only” task. Behavioural protocol (a) and topology of hippocampal co-firing graphs (b) for unrewarded exploration of a novel enclosure (n = 585 total principal cells; 45.0±13.7 principal cells per day; 13 days from 5 mice yielding n=78 graphs; 28,192 co-firing pairs). Each day, mice explored the familiar enclosure before (exposure) and after (re-exposure) exploring a novel enclosure over four sessions, without sucrose reward. The session timeline matches that of the CPP task. (a) An example mouse trajectory for each session is shown for one day below the schematic of in-use enclosures. Additional examples shown below for two other days (one day per row). (b) The topological changes in clustering (top), geodesic path length (middle) and single-neuron cumulative co-firing strength (bottom) of co-firing graphs. For each measure, the entire “Novel context only” dataset is presented using a Cumming estimation plot to visualize the effect size. Each upper panel shows the distribution of raw data points (one point represents one principal cell) for each color-coded session (with the gapped lines on the right as mean (gap) ± SD (vertical ends) for each session). Each lower panel displays the difference between a given session and exposure, computed from 5,000 bootstrapped resamples and with difference-axis origin aligned to the median of the exposure distribution. For each session: black-dot, median; black-ticks, 99% confidence interval; filled-curve: sampling-error distribution. Note that exploring a novel context causes topological deviations from the co-firing graph that had featured exposure, indicating that the hippocampal network “learns” about the novel spatial layout. These deviations no longer occurred during re-exposure. c-e, “Spontaneous Place Preference” (SPP) task. Behavioural protocol (c) and performance (d) along with the graph topology (e) (n=640 total principal cells; 49.2±17.5 principal cells per day; 13 days from 6 mice yielding n=78 graphs; 34,838 co firing pairs). Each day, mice explored the familiar arena before (exposure) and after (re-exposure) exploring a CPP-like apparatus formed by two novel compartments (Nov 1 and Nov 2) connected with a bridge (pre-test). Having identified the preference of each mouse for one of the two novel compartments, the bridge was next removed; each mouse explored its non-preferred compartment, and then its preferred compartment, as in the CPP task but without sucrose nor water. One hour after, the bridge was re-inserted to test place preference (SPP test). The session timeline matches that of the CPP task. c, Example mouse trajectories as in (a). Numbers indicate place preference scores for pre-test and SPP test, as the time in the non-preferred compartment minus that in the preferred compartment over the sum. Note that mice did not changed their preference, as indicated by the negative scores. d, Scores presented using a Gardner-Altman estimation plot (as in Extended Data Fig. 1b). Note that co-firing topology also deviates during SPP sessions from that featuring exposure. Topological deviations no longer marked re-exposure. f,g, “Familiar context with reward” task. Behavioural protocol (f) and graph topology (g) (n=517 total principal cells; 57.4±12.2 principal cells per day; 9 days from 3 mice yielding n=54 graphs; 30,512 co firing pairs). Each day, mice explored the first familiar arena before (exposure) and after (re-exposure) exploring a second familiar enclosure during four sessions. The timeline matches that of the CPP task. Drops of sucrose (+Suc.) and water (+Wat.) were provided during Fam 2b and Fam 2c sessions, respectively. Example mouse trajectories from three days (f) shown as in (a). g, Similar to the unrewarded exploration of novel enclosures (b,e), co-firing graph topology deviated during exploration of the second familiar arena when paired with reward. These deviations no longer marked re-exposure to the first familiar enclosure. h,i, “Familiar context only” task. Behavioural protocol (h) and network topology measured by co-firing strength (i) during exploration of a familiar enclosure without reward (n=658 total principal cells; 59.3±15.8 principal cells per day; 11 days from 3 mice yielding n=44 graphs; 40,744 co firing pairs). Each day, mice explored a familiar enclosure (Fam 1 or Fam 2) over four sessions, to match the four sessions used between exposure and re-exposure in the other tasks (Fig. 1a and Extended Data Fig. 2a–g). h, Example mouse trajectories shown as in (a). i, Co-firing strength did not deviate during repeated familiar explorations. j, Topological changes between exposure and re-exposure are compared across tasks. Note the sustained deviations (topological “hysteresis”) following CPP.

Nature Neuroscience | www.nature.com/natureneuroscience

Brief Communication

NaTurE NEuroSciEncE

Extended Data Fig. 3 | See next page for caption.

Nature Neuroscience | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

Brief Communication

Extended Data Fig. 3 | Topological changes between exposure and re-exposure in the CPP task do not relate to differences in spatial exploration or mere fluctuations in co-firing. a, Spatial occupancy during exposure and re-exposure for example CPP days from four mice (one mouse day per row; using examples shown in Extended Data Fig. 1). Shown for each day, from left to right: (i) animal’s trajectory for each familiar session, (ii) map of pixel-wise dwell time difference across the two sessions (for each pixel, the time spent in that pixel during exposure minus re-exposure), (iii) distribution of pixel-wise dwell time differences for all pixels covering the familiar enclosure, showing no significant difference of the mean from 0 (all Ps>0.05), and (iv) corresponding Gardner-Altman estimation plot to visualize the effect size of the pixel-wise dwell time difference across the two sessions. For each Gardner-Altman plot: left panels show the raw data points for exposure (grey) and re-exposure (green), with each point representing the dwell time in a given pixel; right panel: mean (black-dot), 95% confidence interval (black-ticks) and sampling-error distribution (filled-curve) of the difference between re-exposure and exposure, computed from 5,000 bootstrapped resamples and with the difference-axis (dashed-line) origin aligned to the mean of the exposure distribution. b, Pixel-wise dwell time difference in spatial occupancy across the two sessions for all CPP days, as in (a). Average time difference distribution (left) not significantly different from 0 (1-sample t-test, p=0.53, t=0.62, df=1461; in sec per spatial bin: mean difference=0.05±0.08; 95% confidence interval=[0.106, -0.205]; interquartile range=[1.306, -0.870]), as also shown in the corresponding Gardner-Altman plot (right). c, Cumming estimation plots showing the absolute number of pixels visited in each CPP task session (top; each dot representing one mouse CPP day) and the fraction of visited pixels in each enclosure (bottom). Note that the animal’s coverage was not significantly different between exposure and re-exposure. The higher number of pixels visited during pre-test and CPP test merely reflects the higher dimension of the whole-CPP apparatus. d, Example time course of a mouse instantaneous speed during exposure (top) and re-exposure (bottom) in one CPP day. e, Instantaneous speed across the six sessions for all CPP days (bar charts: mean±SEM; with each superimposed dot representing one mouse CPP day). No significant differences across sessions with respect to exposure (P values: pre-text=0.25; +Suc.=0.38; +Wat.=0.76; CPP test=0.82; Re-exposure=0.98; all 2-sample Kolmogorov-Smirnov tests). f, Average speed across the six CPP task sessions (top) along with the total distance travelled (bottom; calculated for the first 15 min of each session). Note that the significant increased speed and distance travelled during pre-test (when the mouse is exposed for the first time to the novel CPP apparatus) do not translate in topological differences (Fig. 1f). These analyses (a-f) show that the topological hysteresis during re-exposure compared to exposure (Fig. 1f) does not reflect non-specific changes in spatial exploration. g, Topology alterations of hippocampal graphs in re-exposure (Fig. 1f) do not reflect mere fluctuations in co-firing. To control for natural variations in co-firing graphs, we split both exposure and re-exposure in two sections (1 and 2) with equal duration of active exploration (speed>2 cm/sec; exposure: 6.89±0.13 versus 6.97±0.10 min; re-exposure: 6.99±0.30 versus 6.85±0.31 min, all Ps>0.05; Wilcoxon signed-rank test) and quantified topological changes across. As for all topological analyses, sharp-wave/ripples were excluded (though their occurrence did not differ between exposure and re-exposure; t=-1.55, p=0.14, paired t-test). For each measure: the top panel shows the raw data points for each (color-coded) section (with the gapped lines on the right as mean (gap) ± SD (vertical ends)); the bottom-left panel shows the difference between the bootstrapped distribution with respect to first section of exposure; the bottom-right panel shows the difference between the distribution of the second compared to the first section within each familiar session. Note that co-firing topology did not significantly change during each individual familiar exploration. For each section: black-dot, median; black-ticks, 95% confidence interval; filled-curve: bootstrapped sampling-error distribution.

Nature Neuroscience | www.nature.com/natureneuroscience

Brief Communication

NaTurE NEuroSciEncE

Extended Data Fig. 4 | See next page for caption.

Nature Neuroscience | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

Brief Communication

Extended Data Fig. 4 | Familiar map-representations are largely reinstated during re-exposure after CPP but include edits not explained by mere fluctuations. a,b, Cumming estimation plots showing the effect size for changes in the similarity of both single-neuron (a) and population (b) spatial maps across CPP task sessions, with respect to (w.r.t.) exposure. For the single-neuron map similarity analysis (a), each data point represents the Pearson correlation using the firing rate of an individual neuron between the spatial bins of its map during exposure matched to those in a subsequent session. Note that single-neuron familiar maps are well reinstated during re-exposure following their reorganization during CPP sessions. For the population-level map similarity analysis (b), each data point represents the extent to which on a given CPP day pairs of cells that jointly represented a location during exposure continued to show spatially overlapping firing fields in subsequent sessions. This indicates that the combination of cell pairs sharing place fields during exposure largely re-emerges during re-exposure after their re-organization in the CPP enclosure, consistent with the remapping of hippocampal maps across spatial contexts (for example, Muller, R. U. & Kubie, J. L., J. Neurosci. 1987; Wilson, M. A. & McNaughton, B. L., Science 1993; Leutgeb, S. et al, Science 2004; Wills, T. J. et al, Science 2005; Colgin, L. L. et al, Trends in Neurosciences 2008). c-g, The strength of familiar map reinstatement from exposure to re-exposure was compared to non-specific fluctuations in firing activity over time. (c) With respect to the first section (half) of exposure, shown is the effect size for changes in single-neuron map similarity during the second section of the exposure, the 4 CPP sessions and the two (first and second) sections of re-exposure. d, Same as (c) but for the population map similarity. e,f, To contrast the effect of CPP on familiar map reinstatement against within-session variations in single-neuron (c) and population (d) map similarity, we compared the spatial correlation of hippocampal maps between exposure and re-exposure (Re-exposure across) with that between the two sections of the exposure (Exposure within) and of the re-exposure (Re-exposure within). The across-session fluctuations were quantified by comparing maps of each of the two re-exposure half sections (computed as in (c,d)) with those of the two exposure half sections, taking the mean of the four resulting similarity scores. The within-session fluctuations were obtained by comparing maps of the two sections of exposure or re-exposure, as indicated. Note that both single-neuron (e) and population-level (f) map fluctuations are significantly smaller within an exploration session of the familiar enclosure than across, even though single-neuron map variations (e) within re-exposure are markedly larger than those within exposure before CPP. g, In addition, the effect of CPP on familiar map reinstatement was compared to familiar map reinstatement between exposure and re-exposure in the other tasks: unrewarded exploration of a novel enclosure (Novel only), spontaneous place preference for a novel place (SPP) and reward experience in another familiar enclosure (Familiar with reward). Altogether, these analyses show that while spatial maps expressed during re-exposure following CPP are strongly correlated with those initially seen during exposure before CPP (a,b), these reinstated maps nevertheless differ across these two sessions in the familiar enclosure of the CPP task more than changes expected from non-specific fluctuations occurring within a given exploration of the familiar enclosure or those due to the temporal gap between exposure and re-exposure (c-g). These results indicate a crosstalk between the new CPP memory and the prior hippocampal representation of the familiar enclosure. Subsequent analyses in this study relate such a crosstalk to changes in firing activity of low rate principal cells (see Extended Data Figs. 7–10). For each Cumming estimation plot: black-dot, median or mean as indicated; black-ticks, 95% confidence interval; filled-curve: bootstrapped sampling-error distribution.

Nature Neuroscience | www.nature.com/natureneuroscience

Brief Communication

NaTurE NEuroSciEncE

Extended Data Fig. 5 | See next page for caption.
Nature Neuroscience | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

Brief Communication

Extended Data Fig. 5 | Visualizing directions of hippocampal graph transformations in the network co-firing space. a, Computing the topological distances that separate co-firing graphs across the six task sessions. The co-firing graph of each task session was used to define a 6-dimensional vector of topological Riemannian Log-Euclidean distances to the other co-firing graphs obtained that day (for example here illustrated re-exposure versus exposure), including itself (see Methods). For each 6-session task day, this procedure thus gives a 6 x 6 matrix of topological distances. All distance matrices were then stacked together to form a 6 x N matrix (with N the number of total graphs, that is N = 17 days x 6 sessions = 102) onto which we apply a dimensionality reduction technique (PCA, ICA or MDS). b,c, Segregation of co-firing graphs using Independent Components Analysis (ICA; b) or Multidimensional Scaling (MDS; c). (b) ICA applied to the same matrices of topological distances used with PCA in the CPP dataset (Fig. 2) as another dimensionality reduction method to visualize axes explaining across-session variance in co-firing motifs. Note that co-firing graphs computed for the exposure and the re-exposure overlap on the first two independent components (IC) as they do along the first principal component (Fig. 2c–e); co-firing graphs are separated across the 4 CPP task events, as they are along the second principal component (Fig. 2c–e). (c) MDS also applied to the same matrices of topological distances used with PCA in the CPP dataset (Fig. 2); this method preserves the six-dimensional distances between co-firing graphs and maps them onto a 2D plane. Note that the co-firing graphs computed for each task session of each CPP day are well separated, indicating the existence of multiple axes along which co-firing patterns change across CPP task events. d,e, Here the Pearson correlation coefficient is used instead of the Riemannian Log-Euclidean distance to compute the topological distance between co-firing graphs across the six CPP task sessions. In (d) the average topological distance matrix (left) and its first three PCs (right) are shown. In (e) the segregation of the six CPP task sessions is shown using the PCs shown in (d). Note that for both the Riemannian Log-Euclidean distance (Fig. 2c–e) and the Pearson correlation coefficient (d,e) approaches, the PCA of the CPP dataset reveals that the variance in hippocampal co-firing segregated the familiar enclosure from the whole CPP test apparatus along PC1. Surprisingly, PC1 did not segregate the two compartments (Nov1 and Nov2) that formed the CPP apparatus on each day. This suggests that these compartments were treated together as one spatial continuum along PC1 because when the animal first encountered the CPP apparatus, these two compartments were equally novel and physically connected by the bridge during the pre-test. Therefore, a refined interpretation why along PC1 the two CPP compartments are clustered together (and different from the familiar enclosure) is that neuronal co-firing along this axis also accounts for spatial familiarity versus novelty. f,g, PCA with the two compartments of the CPP apparatus considered separately during both pre-test (f) and CPP test (g) sessions. Here, we computed a co-firing graph using the spike trains associated with the visits of each CPP compartment during both test sessions, thus obtaining one co-firing graph per individual compartment (Nov1 versus Nov2) during each test session. Projecting the resulting four co-firing graphs (two for pre-test and two for CPP test) onto the PCA axes obtained when considering the CPP apparatus as a whole entity (Fig. 2e) shows that PC2 segregates co-firing patterns related to each CPP compartment during test compared to pre-test. Likewise, PC2 segregated the two CPP compartments when explored separately during the conditioning sessions where we removed the bridge (Fig. 2e). h-j, The topological distance projections of the co-firing graphs from the other 6-session tasks. As for the CPP dataset, multiple PCs accounted for the variance in co-firing across the 6 sessions of each task. Note, however, that co-firing variance relates to the specifics of each task, and so is each set of PCs and their interpretation. For each task, we used the PCs explaining at least 80% of the total variance to project the co-firing graphs topological distance. The variance explained by these PCs is: “Novel context only” PC1=57%, PC2=19% and PC3=8%; “Spontaneous Place Preference” PC1=52%, PC2=18% and PC3=16%; “Familiar context with reward experience” PC1=69%, PC2=15%; and “CPP” PC1=48%, PC2=19% and PC3=14% (Fig. 2e).

Nature Neuroscience | www.nature.com/natureneuroscience

Brief Communication

NaTurE NEuroSciEncE

Extended Data Fig. 6 | See next page for caption.
Nature Neuroscience | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

Brief Communication

Extended Data Fig. 6 | High and low rate CA1 principal cells are skewed towards deep and superficial pyramidal sublayers, respectively. a-d, For each CPP task day, we estimated the position (depth) of individual tetrode-recorded principal cell soma by leveraging silicon probe recordings with known spacing between the recording sites along a linear shank (25-μm steps). From these silicon probe recordings, we first computed the laminar profile of sharp-wave/ripples (SWRs) detected in the local field potentials (LFPs) along the radial axis of the dCA1 hippocampus (a). We used the peak of the corresponding depth profile of the ripple-band (110-250Hz) power to estimate the centre (middle) of the pyramidal (pyr.) layer (b; red cross). Using the average LFP waveform of the SWR events detected in these silicone probe recordings, we then established a SWR template where we reported the distance relative to the estimated centre of the pyramidal layer, knowing the precise distance between the recording sites on the linear shank (c). Next, we computed the individual SWR profile of each tetrode for CPP recording days finishing with a sleep session, this way estimating the depth of each individual tetrode (and thus that of the somas of its recorded neurons) by positioning its SWR profile within the silicone probe SWR template (the ground-truth vertical depth; c). Shown in (d) are examples of single-tetrode SWR profiles and their estimated depth. (e) Left: the estimated depth of principal cells as a function of the average firing rate measured in the CPP task. Each data point represents one principal cell. Right: the same data plotted as a firing rate probability distribution per estimated depth. f, Same data as in (e) but plotted as a ridge plot to better visualise the relation between firing rate of principal cells and depth of their recording tetrodes. Note that principal cells in the deep sublayer of the dCA1 pyramidal layer (closer to stratum oriens) show higher firing rates than those in the superficial sublayer (closer to stratum radiatum) (line of best fit: y=23.34log(x)-74.7; p=10−30; two-sided Wald Test). g,h, The same analyses shown in (e,f) but performed for the bursting index. Note that principal cells of the deep dCA1 sublayer show higher spike bursting compared to those of the superficial sublayer (line of best fit: y=47.43log(x)-15.0; p=10-64; two-sided Wald Test). (i) Relative prevalence (left) and cumulative distribution (right) of low (blue) and high (red) rate principal cells along the dCA1 radial axis. Low and high activity cells are skewed towards superficial and deep dCA1 pyramidal sublayers, respectively (p=0.016, Kolmogorov-Smirnov 2-sample test).

Nature Neuroscience | www.nature.com/natureneuroscience

Brief Communication

NaTurE NEuroSciEncE

Extended Data Fig. 7 | See next page for caption.

Nature Neuroscience | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

Brief Communication

Extended Data Fig. 7 | Low activity principal cells show increased firing activity during re-exposure to the familiar enclosure following CPP learning. a, Example spike trains of low and high activity cells during exposure and re-exposure to the familiar environment. For each of the eight example cells, shown are two raster plots (60-s rows; vertical ticks representing spike times) for exposure (upper plot) and re-exposure (lower plot). For clarity, only the first 5 min of each session are presented. Note the increased spike burst discharge by low activity cells during re-exposure compared to exposure. b, Cumming estimation plot used to visualize for low (blue colours) and high (red colours) activity cells the effect size for changes in spike bursting between re-exposure and exposure. Upper panel: distributions of raw data points (each color-coded point represents one cell from the CPP task: n=272 low activity cells and 272 high activity cells) during exposure and re-exposure in light and dark colours, respectively; with the gapped lines on the right as mean (gap) ± SD (vertical ends) for a given subpopulation in a given session. Middle panel: the median (black-dot), 95% confidence interval (black-ticks) and sampling-error distribution (filled-curve) of the difference between (low or high activity) cells in a given session and the low activity cells in exposure, computed from 5,000 bias-corrected bootstrapped resamples and with the difference-axis (dashed-line) origin aligned to the median of low activity cells in exposure. Lower panel: similarly, compares the distribution in re-exposure to that in exposure within each subpopulation. Note that low, but not high, activity cells significantly discharge more bursts of spikes during re-exposure following CPP compared to exposure. The lack of increased bursting of the high activity cells during re-exposure compared to exposure does not reflect a ceiling effect given that the burst spiking distribution of this subpopulation had an inter-quartile range=0.07–0.18, a median=0.12 and a mean=0.15 throughout the CPP task sessions (see also the corresponding raw data points in Extended Data Fig. 9d and the coherence-percentiles’ mean in Extended Data Fig. 9h), showing that this subpopulation could have discharged more bursts during re-exposure. c, Cumming estimation plots to visualize the change in firing rate across CPP task sessions for the low (left panel) and the high (right panel) activity cell subpopulations. Note that firing rate of low activity cells increased during CPP sessions and stayed at higher values during re-exposure, not resetting to the values seen in exposure. d-i, Bursting index (d-f) and firing rate (g-i) of high and low activity principal cells in the exposure and re-exposure to the familiar enclosure during the other tasks: exploration of a novel enclosure only (d,g), spontaneous place preference for a novel place (e,h) and exploration of another familiar enclosure with reward (f,i). Each (color-coded) data point represents one cell (“Novel context only” task: n=214 low activity cells and 128 high activity cells; “Spontaneous Place Preference” task: n=188 low activity cells and 152 high activity cells; “Familiar context with reward experience” task: n=148 low activity cells and 96 high activity cells). All differences presented using Cumming estimation plots as in (b). Note that in these three other tasks, low activity cells did not show significant changes in burst spiking and firing rate during re-exposure compared to exposure.

Nature Neuroscience | www.nature.com/natureneuroscience

Brief Communication

NaTurE NEuroSciEncE

Extended Data Fig. 8 | Low activity cells with increased burst spiking following CPP exhibited stronger place field coherence and spatial information content. a,b, Cumming estimation plots showing for low (blue colours) and high (red colours) activity cells the effect size in changes of place field coherence (a) and spatial mutual information (b) between exposure and re-exposure in the CPP task. The most burst spiking cells of both subpopulation (top 40% of bursting index distribution) in the re-exposure session are considered. Note that low, but not high, activity cells have significantly higher spatial coherence (a) and mutual information (b) during re-exposure after CPP. c-h, Similarly, the place field coherence (c,e,g) and the spatial mutual information (d,f,h) of low and high activity principal cells is shown for the other tasks including exposure and re-exposure sessions. Low and high activity cells selected in the same way as in the CPP task dataset (a,b) to allow for comparison. For all Cumming estimation plots: black-dot, median (for skewed distributions) or mean (for normal distributions) as indicated; black-ticks, 95% confidence interval; filled-curve: bootstrapped sampling-error distribution.
Nature Neuroscience | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

Brief Communication

Extended Data Fig. 9 | See next page for caption.
Nature Neuroscience | www.nature.com/natureneuroscience

Brief Communication

NaTurE NEuroSciEncE

Extended Data Fig. 9 | Relation between spatial field coherence during exposure and subsequent changes in both burstiness and spatial information for low and high activity cells in the CPP task. a,b, The spatial mutual information of low and high activity cells is plotted against their respective spatial coherence for each of the six CPP task sessions. Each data point represents one cell. Comparing with exposure, note the right-shift towards higher spatial information for a set of low activity cells during the CPP sessions, which then remained at higher values during re-exposure (a). c,d, Similarly, the bursting index of low and high activity cells is plotted against their spatial coherence for each CPP task session. Also comparing with exposure, note the right-shift towards higher spike bursting in the distributions of low activity cells during CPP sessions, remaining higher during re-exposure (c). e-h, For each of the six CPP task sessions, both low (e,f) and high (g,h) activity cell subpopulations were binned in 20th-percentiles according to the spatial coherence of each cell’s place field during the exposure session. Then, the average spatial mutual information (e,g) and bursting index (f,h) were computed for each 20th-percentile bins across all task sessions. For clarity, the bins of the re-exposure session marked with a white star (*) have significant changes in either measure (spatial information or bursting index) compared to the corresponding bins in the exposure session. Note that during re-exposure, low activity cells show significant increase in spatial information following CPP compared to exposure (e). This was not the case for high activity cells (g). Moreover, low activity cells with the least (0th–60th percentiles) spatial coherence during exposure increased their spike bursting during the CPP sessions and thereafter during re-exposure (f; with statistically different percentile bins marked with a white star compared to their corresponding bins in exposure). This was not seen for high activity cells (h). i-l, Cumming estimation plots showing the effect size for changes in spatial information (i,k) and bursting index (j,l) for the low (i,j) and the high (k,l) activity cell subpopulations, binned as 20th-percentiles according to the spatial coherence of each cell’s place field during exposure. For further clarity, the black stars above the green filled-curves in re-exposure indicate significant changes compared to exposure. Note that across all percentile bins, low activity cells show significant increase in spatial information in re-exposure compared to exposure (i). This was not seen for high activity cells (k). Moreover, low activity cells with the least (0th–60th percentiles) spatial coherence during exposure thereafter discharged more spike bursts during the CPP sessions and continued to exhibit significant higher burstiness during re-exposure compared to exposure (f,j; see stars). High activity cells maintained the same burstiness throughout all task sessions (h,l). For each Cumming estimation plot: black-dot, mean; black-ticks, 95% confidence interval; filled-curve: bootstrapped sampling-error distribution. Altogether, these analyses show that CPP learning subsequently affected low activity cells during re-exposure to the familiar environment. Notably, these results show that the dCA1 network gained in spatial information content during re-exposure (compared to exposure) from both: (1) low activity cells that were already spatially tuned during exposure and then exhibited higher spatial informativeness following CPP (e,i), and (2) low activity cells that were not spatially tuned during exposure but were de-novo recruited during CPP, after which they stayed more active during re-exposure (f,j). These results are in line with the increase in spatial coherence observed for the most burst spiking of the low, but not high, activity cells during re-exposure compared to exposure (Extended Data Fig. 8a), and the gradual engagement of low activity cells in whole-network co-firing motifs (see Fig. 3c and Extended Data Fig. 10d).

Nature Neuroscience | www.nature.com/natureneuroscience

NaTurE NEuroSciEncE

Brief Communication

Extended Data Fig. 10 | See next page for caption.
Nature Neuroscience | www.nature.com/natureneuroscience

Brief Communication

NaTurE NEuroSciEncE

Extended Data Fig. 10 | High and low activity principal cells make distinct contributions to network co-firing motifs. a, Cumming estimation plots showing CPP task-related changes in topological clustering (top), geodesic path length (middle) and single-neuron cumulative co-firing strength (bottom) of co-firing graphs (with respect to exposure) for low and high activity cells. Black-dots, median; black-ticks, 95% confidence interval; filled-curve: sampling-error distribution. b, Top, schematic showing the location of the containers for the sucrose and water drops in an example CPP enclosure. Bottom, distribution of firing rate changes (scores) between the +Suc and pre-test sessions for low and high activity cells (low activity cells: p=2.68x10-5, t=4.279, df=251; high activity cells: p=0.25, t=1.160, df=271; 1-sample t-tests against 0 mean). For every cell that fired at least 100 spikes in either session, a score is obtained by taking the difference between its mean firing rate at the containers during +Suc and pre-test sessions, dividing by the sum. c, The change in firing rate at the containers from pre-test to +Suc. session correlated with the change in co-firing strength from exposure to re-exposure for the low (regression line y=0.21x-0.11; p=0.018, Wald test) but not the high (regression line y=0.12x-0.23; p=0.51, Wald test) activity cells. Together with the topological deviations that feature the low activity cell co-firing graphs (a), this result supports the idea that during the mnemonic update of a newly encountered place with reward experience, a change in the firing activity of low activity cells allows a cross-talk between the new CPP memory and the prior representation of the familiar enclosure, as reported along PC3 (Fig. 3d). d, Contribution of low and high activity cells to network co-firing motifs, as measured by the proximity between the high (right) and low (left) activity sub-networks to the whole network (that is, containing the full distribution of all recorded neurons) in the topological distance space across the six CPP task events (w.r.t. low activity cells in exposure). Black-dot, median or mean as indicated; black-ticks, 99% confidence interval; filled-curve: sampling-error distribution. e, For low and high activity cells, firing rate changes during sharp-wave/ripples (SWRs) detected in periods of immobility (speed<2cm/sec) of exposure and re-exposure sessions. For every cell, the change in SWR firing is measured as the difference between its mean firing rate during SWRs in the exposure and re-exposure sessions divided by the subpopulation’s average firing rate during SWRs of exposure. f, Change in co-firing during SWRs between exposure and re-exposure for low-low, low-high and high-high activity cell pairs. SWR co-firing computed during SWRs detected in periods of immobility (speed<2cm/sec) of a given exploration session in the familiar enclosure. The change in co-firing between re-exposure and exposure was then divided by the average subpopulation’s co-firing. Note the increased SWR co-firing between low-low and low-high activity cells during the re-exposure session following CPP learning.

Nature Neuroscience | www.nature.com/natureneuroscience

nature research | reporting summary

Corresponding author(s): David Dupret Last updated by author(s): Dec 2, 2020
Reporting Summary
Nature Research wishes to improve the reproducibility of the work that we publish. This form provides structure for consistency and transparency in reporting. For further information on Nature Research policies, see our Editorial Policies and the Editorial Policy Checklist.

Statistics
For all statistical analyses, confirm that the following items are present in the figure legend, table legend, main text, or Methods section. n/a Confirmed
The exact sample size (n) for each experimental group/condition, given as a discrete number and unit of measurement A statement on whether measurements were taken from distinct samples or whether the same sample was measured repeatedly The statistical test(s) used AND whether they are one- or two-sided Only common tests should be described solely by name; describe more complex techniques in the Methods section. A description of all covariates tested A description of any assumptions or corrections, such as tests of normality and adjustment for multiple comparisons A full description of the statistical parameters including central tendency (e.g. means) or other basic estimates (e.g. regression coefficient) AND variation (e.g. standard deviation) or associated estimates of uncertainty (e.g. confidence intervals)
For null hypothesis testing, the test statistic (e.g. F, t, r) with confidence intervals, effect sizes, degrees of freedom and P value noted Give P values as exact values whenever suitable.
For Bayesian analysis, information on the choice of priors and Markov chain Monte Carlo settings For hierarchical and complex designs, identification of the appropriate level for tests and full reporting of outcomes Estimates of effect sizes (e.g. Cohen's d, Pearson's r), indicating how they were calculated
Our web collection on statistics for biologists contains articles on many of the points above.

Software and code
Policy information about availability of computer code
Data collection Neural data was acquired using the integrated circuit RHD2164 from Intan Technologies; single unit isolation was performed using KlustaKwik and Kilosort via the SpikeForest sorting framework.

Data analysis

Data were analysed in Python 3.6 and using the packages DABEST v0.3.0, scikit-learn v0.23.2, NetworkX v2.4, pyentropy v0.5.0, Numpy v1.18.1, Scipy v1.4.1, Matplotlib v3.1.2, Pandas v0.25.3 and Seaborn v0.11.0

For manuscripts utilizing custom algorithms or software that are central to the research but not yet described in published literature, software must be made available to editors and reviewers. We strongly encourage code deposition in a community repository (e.g. GitHub). See the Nature Research guidelines for submitting code & software for further information.

Data
Policy information about availability of data All manuscripts must include a data availability statement. This statement should provide the following information, where applicable:
- Accession codes, unique identifiers, or web links for publicly available datasets - A list of figures that have associated raw data - A description of any restrictions on data availability
The data that support the findings of this study are available from the corresponding author upon reasonable request.

April 2020

1

nature research | reporting summary

Field-specific reporting

Please select the one below that is the best fit for your research. If you are not sure, read the appropriate sections before making your selection.

Life sciences

Behavioural & social sciences

Ecological, evolutionary & environmental sciences

For a reference copy of the document with all sections, see nature.com/documents/nr-reporting-summary-flat.pdf

Life sciences study design

All studies must disclose on these points even when the disclosure is negative.

Sample size

The dataset includes a total of 3,483 CA1 principal cells. No statistical methods were used to pre-determine sample sizes but our sample sizes are similar to those reported in previous publications (e.g., ref 5,8,10,12,13,15–19).

Data exclusions No mice were excluded. Inclusion criteria for well-isolated single units were used as published in previous studies and described in the methods section.

Replication

The co-firing topological effects described were reproduced in the DABEST statistical framework for all recording sessions and mice.

Randomization

The various experimental conditions (ie., "CPP", "Novel context only", "SPP", "Familiar context with reward" and "Familiar context only" conditions) were randomly allocated across mice and recording days. Covariates were controlled within subject, within co-firing graph and across task sessions.

Blinding

Data collection could not be performed blind to the conditions of the experiments since the experimenter had to be aware as to which conditions they had to expose each mouse on a given day (which behavioural task) and on a given session (which open-field arena). Neural and behavioural data analyses were conducted in an identical way regardless of the identity of the experimental condition from which the data were collected, with the investigator blind to group allocation during data collection and/or analysis.

Reporting for specific materials, systems and methods

We require information from authors about some types of materials, experimental systems and methods used in many studies. Here, indicate whether each material, system or method listed is relevant to your study. If you are not sure if a list item applies to your research, read the appropriate section before selecting a response.

Materials & experimental systems
n/a Involved in the study Antibodies Eukaryotic cell lines Palaeontology and archaeology Animals and other organisms Human research participants Clinical data Dual use research of concern

Methods
n/a Involved in the study ChIP-seq Flow cytometry MRI-based neuroimaging

Animals and other organisms

Policy information about studies involving animals; ARRIVE guidelines recommended for reporting animal research

Laboratory animals

These experiments used adult male C57BL/6J mice (Charles River Laboratories, UK) or transgenic heterozygous CamKIIa-Cre mice (Jackson Laboratories; CamKIIa-Cre B6.Cg-Tg(Camk2a-cre)T29-1Stl/J, stock number 005359, RRID: IMSR_JAX:005359; maintained on a C57BL/6J background). Mice were housed with their littermates until the surgical procedure with free access to food and water in a room with a 12/12h light/dark cycle, 19–23°C ambient temperature and 40–70% humidity. All mice held in IVC's, with wooden chew stick and nestlets. Mice were 4-7 months old at the time of testing.

Wild animals

No wild animals were used in the study.

Field-collected samples No field collected samples were used in the study.

Ethics oversight

Experimental procedures performed on mice in accordance with the Animals (Scientific Procedures) Act, 1986 (United Kingdom), with final ethical review by the Animals in Science Regulation Unit of the UK Home Office.

Note that full information on the approval of the study protocol must also be provided in the manuscript.

April 2020

2

